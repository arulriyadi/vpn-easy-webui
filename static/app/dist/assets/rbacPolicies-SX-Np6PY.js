import{_ as U,r as f,q as E,o as G,c as n,b as t,f as u,F as _,m as x,t as d,h as q,z as p,C as h,A as g,e as P,L as j,a,s as L,n as B}from"./index-BHlSp020.js";const z={name:"RBACPolicies",setup(){const A=f([]),o=f([]),b=f([]),e=f(!1),y=f("filter"),k=f(null),l=f({group_id:"",destination:"",action:"",protocol:"any",port:"",translated_ip:"",translated_port:"",priority:100}),i=E(()=>y.value==="nat"&&["SNAT","DNAT"].includes(l.value.action)),w=E(()=>y.value==="nat"&&["DNAT","REDIRECT"].includes(l.value.action)),C=async()=>{e.value=!0;try{const s=await(await fetch("/api/rbac/groups")).json();s.status&&(A.value=s.data);for(const c of A.value){const N=await(await fetch(`/api/rbac/groups/${c.id}/policies/filter`)).json();N.status&&(o.value=o.value.concat(N.data));const F=await(await fetch(`/api/rbac/groups/${c.id}/policies/nat`)).json();F.status&&(b.value=b.value.concat(F.data))}}catch(r){v("error","Error loading data: "+r.message)}finally{e.value=!1}},M=r=>o.value.filter(s=>s.group_id===r),D=r=>b.value.filter(s=>s.group_id===r),R=(r,s=null)=>{y.value=r,k.value=s,l.value={group_id:s?s.id:"",destination:"",action:"",protocol:"any",port:"",translated_ip:"",translated_port:"",priority:100},new bootstrap.Modal(document.getElementById("policyModal")).show()},I=()=>{l.value.translated_ip="",l.value.translated_port=""},S=async()=>{try{const r=y.value==="filter"?`/api/rbac/groups/${l.value.group_id}/policies/filter`:`/api/rbac/groups/${l.value.group_id}/policies/nat`,s={destination:l.value.destination,action:l.value.action,priority:l.value.priority};y.value==="filter"?(s.protocol=l.value.protocol,s.port=l.value.port):(s.translated_ip=l.value.translated_ip,s.translated_port=l.value.translated_port);const m=await(await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();m.status?(v("success",m.message),bootstrap.Modal.getInstance(document.getElementById("policyModal")).hide(),o.value=[],b.value=[],await C()):v("error",m.message)}catch(r){v("error","Error saving policy: "+r.message)}},V=async(r,s)=>{if(confirm(`Are you sure you want to delete this ${r==="filter"?"Filter":"NAT"} policy?`))try{const m=r==="filter"?`/api/rbac/policies/filter/${s}`:`/api/rbac/policies/nat/${s}`,T=await(await fetch(m,{method:"DELETE"})).json();T.status?(v("success",T.message),o.value=[],b.value=[],await C()):v("error",T.message)}catch(m){v("error","Error deleting policy: "+m.message)}},v=(r,s)=>{const c=document.createElement("div");c.className=`alert alert-${r==="error"?"danger":r} alert-dismissible fade show position-fixed`,c.style.top="20px",c.style.right="20px",c.style.zIndex="9999",c.innerHTML=`
        <i class="bi bi-${r==="success"?"check-circle":"exclamation-triangle"} me-2"></i>
        ${s}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `,document.body.appendChild(c),setTimeout(()=>{c.parentNode&&c.parentNode.removeChild(c)},5e3)};return G(()=>{C()}),{groups:A,filterPolicies:o,natPolicies:b,loading:e,policyType:y,policyForm:l,showTranslatedIp:i,showTranslatedPort:w,getGroupFilterPolicies:M,getGroupNatPolicies:D,openAddPolicyModal:R,onNatActionChange:I,savePolicy:S,deletePolicy:V}}},O={class:"container-fluid"},Q={class:"row"},H={class:"col-12"},J={class:"d-flex justify-content-between align-items-center mb-4"},K={class:"btn-group",role:"group"},W={key:0,class:"text-center p-4"},X={key:1},Y={class:"card-header"},Z={class:"d-flex justify-content-between align-items-center"},$={class:"d-flex align-items-center"},tt={class:"mb-0"},ot={class:"badge bg-secondary ms-2"},lt={class:"btn-group",role:"group"},et=["onClick"],st=["onClick"],it={class:"card-body"},nt={key:0,class:"mb-3"},at={class:"text-muted"},rt={class:"mb-4"},dt={key:0,class:"text-center p-3 border rounded bg-light"},ct={key:1,class:"table-responsive"},ut={class:"table table-sm table-hover"},pt={class:"badge bg-info"},mt=["onClick"],bt={key:0,class:"text-center p-3 border rounded bg-light"},yt={key:1,class:"table-responsive"},vt={class:"table table-sm table-hover"},ft={class:"badge bg-warning"},gt=["onClick"],Pt={class:"modal fade",id:"policyModal",tabindex:"-1","aria-labelledby":"policyModalLabel","aria-hidden":"true"},At={class:"modal-dialog"},Tt={class:"modal-content"},_t={class:"modal-header"},xt={class:"modal-title",id:"policyModalLabel"},ht={class:"modal-body"},wt={class:"mb-3"},Ct=["value"],Nt={class:"mb-3"},kt={key:0},Ft={class:"mb-3"},Et={class:"mb-3"},Mt={class:"mb-3"},Dt={key:1},Rt={class:"mb-3"},It={key:0,class:"mb-3"},St=["required"],Vt={key:1,class:"mb-3"},Ut=["required"],Gt={class:"mb-3"},qt={class:"modal-footer"};function jt(A,o,b,e,y,k){return a(),n("div",O,[t("div",Q,[t("div",H,[t("div",J,[o[16]||(o[16]=t("div",null,[t("h2",{class:"mb-0"},[t("i",{class:"bi bi-shield-shaded me-2"}),u(" RBAC Policy Management ")]),t("p",{class:"text-muted mb-0"},"Manage firewall policies for user groups")],-1)),t("div",K,[t("button",{class:"btn btn-primary",onClick:o[0]||(o[0]=l=>e.openAddPolicyModal("filter"))},o[14]||(o[14]=[t("i",{class:"bi bi-funnel me-2"},null,-1),u(" Add Filter Policy ")])),t("button",{class:"btn btn-warning",onClick:o[1]||(o[1]=l=>e.openAddPolicyModal("nat"))},o[15]||(o[15]=[t("i",{class:"bi bi-arrow-left-right me-2"},null,-1),u(" Add NAT Policy ")]))])]),e.loading?(a(),n("div",W,o[17]||(o[17]=[t("div",{class:"spinner-border",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1)]))):(a(),n("div",X,[(a(!0),n(_,null,x(e.groups,l=>(a(),n("div",{key:l.id,class:"card mb-4"},[t("div",Y,[t("div",Z,[t("div",$,[t("div",{class:"me-2",style:L(`width: 12px; height: 12px; background-color: ${l.color}; border-radius: 50%;`)},null,4),t("h5",tt,d(l.name),1),t("span",ot,d(l.peer_count||0)+" peers",1)]),t("div",lt,[t("button",{class:"btn btn-sm btn-outline-primary",onClick:i=>e.openAddPolicyModal("filter",l)},o[18]||(o[18]=[t("i",{class:"bi bi-funnel me-1"},null,-1),u(" Filter ")]),8,et),t("button",{class:"btn btn-sm btn-outline-warning",onClick:i=>e.openAddPolicyModal("nat",l)},o[19]||(o[19]=[t("i",{class:"bi bi-arrow-left-right me-1"},null,-1),u(" NAT ")]),8,st)])])]),t("div",it,[l.description?(a(),n("div",nt,[t("small",at,d(l.description),1)])):P("",!0),t("div",rt,[o[23]||(o[23]=t("h6",{class:"text-primary"},[t("i",{class:"bi bi-funnel me-2"}),u(" Filter Policies ")],-1)),e.getGroupFilterPolicies(l.id).length===0?(a(),n("div",dt,o[20]||(o[20]=[t("i",{class:"bi bi-funnel text-muted",style:{"font-size":"2rem"}},null,-1),t("p",{class:"text-muted mt-2 mb-0"},"No filter policies defined",-1)]))):(a(),n("div",ct,[t("table",ut,[o[22]||(o[22]=t("thead",null,[t("tr",null,[t("th",null,"Destination"),t("th",null,"Protocol"),t("th",null,"Port"),t("th",null,"Action"),t("th",null,"Priority"),t("th",null,"Actions")])],-1)),t("tbody",null,[(a(!0),n(_,null,x(e.getGroupFilterPolicies(l.id),i=>(a(),n("tr",{key:i.id},[t("td",null,d(i.destination),1),t("td",null,[t("span",pt,d(i.protocol),1)]),t("td",null,d(i.port||"-"),1),t("td",null,[t("span",{class:B(["badge",i.action==="ACCEPT"?"bg-success":"bg-danger"])},d(i.action),3)]),t("td",null,d(i.priority),1),t("td",null,[t("button",{class:"btn btn-sm btn-outline-danger",onClick:w=>e.deletePolicy("filter",i.id)},o[21]||(o[21]=[t("i",{class:"bi bi-trash"},null,-1)]),8,mt)])]))),128))])])]))]),t("div",null,[o[27]||(o[27]=t("h6",{class:"text-warning"},[t("i",{class:"bi bi-arrow-left-right me-2"}),u(" NAT Policies ")],-1)),e.getGroupNatPolicies(l.id).length===0?(a(),n("div",bt,o[24]||(o[24]=[t("i",{class:"bi bi-arrow-left-right text-muted",style:{"font-size":"2rem"}},null,-1),t("p",{class:"text-muted mt-2 mb-0"},"No NAT policies defined",-1)]))):(a(),n("div",yt,[t("table",vt,[o[26]||(o[26]=t("thead",null,[t("tr",null,[t("th",null,"Destination"),t("th",null,"Action"),t("th",null,"Translated IP"),t("th",null,"Translated Port"),t("th",null,"Priority"),t("th",null,"Actions")])],-1)),t("tbody",null,[(a(!0),n(_,null,x(e.getGroupNatPolicies(l.id),i=>(a(),n("tr",{key:i.id},[t("td",null,d(i.destination),1),t("td",null,[t("span",ft,d(i.action),1)]),t("td",null,d(i.translated_ip||"-"),1),t("td",null,d(i.translated_port||"-"),1),t("td",null,d(i.priority),1),t("td",null,[t("button",{class:"btn btn-sm btn-outline-danger",onClick:w=>e.deletePolicy("nat",i.id)},o[25]||(o[25]=[t("i",{class:"bi bi-trash"},null,-1)]),8,gt)])]))),128))])])]))])])]))),128))]))])]),t("div",Pt,[t("div",At,[t("div",Tt,[t("div",_t,[t("h5",xt,d(e.policyType==="filter"?"Add Filter Policy":"Add NAT Policy"),1),o[28]||(o[28]=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),t("div",ht,[t("form",{onSubmit:o[12]||(o[12]=q((...l)=>e.savePolicy&&e.savePolicy(...l),["prevent"]))},[t("div",wt,[o[30]||(o[30]=t("label",{for:"policyGroup",class:"form-label"},[u("Group "),t("span",{class:"text-danger"},"*")],-1)),p(t("select",{class:"form-select",id:"policyGroup","onUpdate:modelValue":o[2]||(o[2]=l=>e.policyForm.group_id=l),required:""},[o[29]||(o[29]=t("option",{value:""},"Select a group",-1)),(a(!0),n(_,null,x(e.groups,l=>(a(),n("option",{key:l.id,value:l.id},d(l.name),9,Ct))),128))],512),[[h,e.policyForm.group_id]])]),t("div",Nt,[o[31]||(o[31]=t("label",{for:"policyDestination",class:"form-label"},[u("Destination "),t("span",{class:"text-danger"},"*")],-1)),p(t("input",{type:"text",class:"form-control",id:"policyDestination","onUpdate:modelValue":o[3]||(o[3]=l=>e.policyForm.destination=l),required:"",placeholder:"e.g., 192.168.1.0/24, 0.0.0.0/0"},null,512),[[g,e.policyForm.destination]]),o[32]||(o[32]=t("div",{class:"form-text"},"IP address or subnet",-1))]),e.policyType==="filter"?(a(),n("div",kt,[t("div",Ft,[o[34]||(o[34]=t("label",{for:"filterAction",class:"form-label"},[u("Action "),t("span",{class:"text-danger"},"*")],-1)),p(t("select",{class:"form-select",id:"filterAction","onUpdate:modelValue":o[4]||(o[4]=l=>e.policyForm.action=l),required:""},o[33]||(o[33]=[t("option",{value:""},"Select action",-1),t("option",{value:"ACCEPT"},"ACCEPT",-1),t("option",{value:"DROP"},"DROP",-1)]),512),[[h,e.policyForm.action]])]),t("div",Et,[o[36]||(o[36]=t("label",{for:"filterProtocol",class:"form-label"},"Protocol",-1)),p(t("select",{class:"form-select",id:"filterProtocol","onUpdate:modelValue":o[5]||(o[5]=l=>e.policyForm.protocol=l)},o[35]||(o[35]=[t("option",{value:"any"},"Any",-1),t("option",{value:"tcp"},"TCP",-1),t("option",{value:"udp"},"UDP",-1),t("option",{value:"icmp"},"ICMP",-1)]),512),[[h,e.policyForm.protocol]])]),t("div",Mt,[o[37]||(o[37]=t("label",{for:"filterPort",class:"form-label"},"Port",-1)),p(t("input",{type:"text",class:"form-control",id:"filterPort","onUpdate:modelValue":o[6]||(o[6]=l=>e.policyForm.port=l),placeholder:"e.g., 80, 443, 22"},null,512),[[g,e.policyForm.port]]),o[38]||(o[38]=t("div",{class:"form-text"},"Optional port number",-1))])])):P("",!0),e.policyType==="nat"?(a(),n("div",Dt,[t("div",Rt,[o[40]||(o[40]=t("label",{for:"natAction",class:"form-label"},[u("Action "),t("span",{class:"text-danger"},"*")],-1)),p(t("select",{class:"form-select",id:"natAction","onUpdate:modelValue":o[7]||(o[7]=l=>e.policyForm.action=l),required:"",onChange:o[8]||(o[8]=(...l)=>e.onNatActionChange&&e.onNatActionChange(...l))},o[39]||(o[39]=[j('<option value="" data-v-587a3227>Select action</option><option value="MASQUERADE" data-v-587a3227>MASQUERADE</option><option value="SNAT" data-v-587a3227>SNAT</option><option value="DNAT" data-v-587a3227>DNAT</option><option value="REDIRECT" data-v-587a3227>REDIRECT</option>',5)]),544),[[h,e.policyForm.action]])]),e.showTranslatedIp?(a(),n("div",It,[o[41]||(o[41]=t("label",{for:"translatedIp",class:"form-label"},[u("Translated IP "),t("span",{class:"text-danger"},"*")],-1)),p(t("input",{type:"text",class:"form-control",id:"translatedIp","onUpdate:modelValue":o[9]||(o[9]=l=>e.policyForm.translated_ip=l),required:e.showTranslatedIp,placeholder:"e.g., 203.0.113.1"},null,8,St),[[g,e.policyForm.translated_ip]])])):P("",!0),e.showTranslatedPort?(a(),n("div",Vt,[o[42]||(o[42]=t("label",{for:"translatedPort",class:"form-label"},[u("Translated Port "),t("span",{class:"text-danger"},"*")],-1)),p(t("input",{type:"text",class:"form-control",id:"translatedPort","onUpdate:modelValue":o[10]||(o[10]=l=>e.policyForm.translated_port=l),required:e.showTranslatedPort,placeholder:"e.g., 8080"},null,8,Ut),[[g,e.policyForm.translated_port]])])):P("",!0)])):P("",!0),t("div",Gt,[o[43]||(o[43]=t("label",{for:"policyPriority",class:"form-label"},"Priority",-1)),p(t("input",{type:"number",class:"form-control",id:"policyPriority","onUpdate:modelValue":o[11]||(o[11]=l=>e.policyForm.priority=l),min:"1",max:"1000",placeholder:"100"},null,512),[[g,e.policyForm.priority]]),o[44]||(o[44]=t("div",{class:"form-text"},"Lower numbers have higher priority (1-1000)",-1))])],32)]),t("div",qt,[o[45]||(o[45]=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),t("button",{type:"button",class:"btn btn-primary",onClick:o[13]||(o[13]=(...l)=>e.savePolicy&&e.savePolicy(...l))},d(e.policyType==="filter"?"Add Filter Policy":"Add NAT Policy"),1)])])])])])}const Bt=U(z,[["render",jt],["__scopeId","data-v-587a3227"]]);export{Bt as default};
//# sourceMappingURL=rbacPolicies-SX-Np6PY.js.map
