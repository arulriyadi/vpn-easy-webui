import{_ as L,r as g,q as k,o as j,c as a,b as s,f as b,t as d,F as p,m as y,e as I,h as S,z as O,C as A,a as l,s as B}from"./index-D8hVfsLB.js";const R={name:"OrganizationAssignments",setup(){const f=g([]),t=g([]),c=g([]),n=g(!1),h=g(null),v=g([]),e=g({user_id:"",organization_id:""}),u=k(()=>c.value.length),M=k(()=>{const i=c.value.filter(o=>o.organization_id===parseInt(e.value.organization_id)).map(o=>o.user_id);return t.value.filter(o=>!i.includes(o.id))}),U=async()=>{n.value=!0;try{const o=await(await fetch("/api/organizations")).json();o.status&&(f.value=o.data);const _=await(await fetch("/api/users")).json();_.status&&(t.value=_.data);for(const w of f.value){const x=await(await fetch(`/api/organizations/${w.id}/users`)).json();x.status&&x.data.forEach(z=>{c.value.push({user_id:z.id,organization_id:w.id,username:z.username,email:z.email,assigned_at:z.assigned_at})})}}catch(i){m("error","Error loading data: "+i.message)}finally{n.value=!1}},C=i=>c.value.filter(o=>o.organization_id===i),D=async i=>{h.value=i;try{const _=await(await fetch(`/api/organizations/${i.id}/users`)).json();_.status&&(v.value=_.data)}catch(r){m("error","Error loading organization users: "+r.message)}new bootstrap.Modal(document.getElementById("orgDetailsModal")).show()},E=(i=null)=>{e.value={user_id:"",organization_id:i?i.id:""},new bootstrap.Modal(document.getElementById("assignUserModal")).show()},N=async()=>{try{const o=await(await fetch(`/api/organization/users/${e.value.user_id}/organizations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e.value.user_id,organization_id:e.value.organization_id})})).json();o.status?(m("success",o.message),bootstrap.Modal.getInstance(document.getElementById("assignUserModal")).hide(),c.value=[],v.value=[],await U()):m("error",o.message)}catch(i){m("error","Error assigning user: "+i.message)}},T=async i=>{if(confirm("Are you sure you want to remove this user from the organization?"))try{const r=await(await fetch(`/api/organization/users/${i}/organizations/${h.value.id}`,{method:"DELETE"})).json();r.status?(m("success",r.message),c.value=[],v.value=[],await U()):m("error",r.message)}catch(o){m("error","Error removing user: "+o.message)}},F=i=>i?new Date(i).toLocaleDateString():"-",m=(i,o)=>{const r=document.createElement("div");r.className=`alert alert-${i==="error"?"danger":i} alert-dismissible fade show position-fixed`,r.style.top="20px",r.style.right="20px",r.style.zIndex="9999",r.innerHTML=`
        <i class="bi bi-${i==="success"?"check-circle":"exclamation-triangle"} me-2"></i>
        ${o}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `,document.body.appendChild(r),setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r)},5e3)};return j(()=>{U()}),{organizations:f,users:t,userOrganizations:c,loading:n,selectedOrg:h,orgUsers:v,assignmentForm:e,totalAssignments:u,availableUsers:M,getOrgUsers:C,viewOrgDetails:D,openAssignUserModal:E,assignUser:N,removeUserFromOrg:T,formatDate:F}}},V={class:"container-fluid"},q={class:"row"},H={class:"col-12"},J={class:"d-flex justify-content-between align-items-center mb-4"},P={class:"row mb-4"},G={class:"col-md-4"},K={class:"card bg-primary text-white"},Q={class:"card-body"},W={class:"d-flex align-items-center"},X={class:"mb-0"},Y={class:"col-md-4"},Z={class:"card bg-success text-white"},$={class:"card-body"},ss={class:"d-flex align-items-center"},ts={class:"mb-0"},es={class:"col-md-4"},ns={class:"card bg-info text-white"},is={class:"card-body"},os={class:"d-flex align-items-center"},as={class:"mb-0"},ls={class:"card"},rs={class:"card-body p-0"},ds={key:0,class:"text-center p-4"},cs={key:1,class:"table-responsive"},ms={class:"table table-hover mb-0"},us={class:"d-flex align-items-center"},gs={class:"text-muted"},bs={key:0,class:"text-muted"},vs={key:1},_s=["onClick"],ps=["onClick"],ys={class:"modal fade",id:"orgDetailsModal",tabindex:"-1","aria-labelledby":"orgDetailsModalLabel","aria-hidden":"true"},fs={class:"modal-dialog modal-lg"},hs={class:"modal-content"},zs={class:"modal-header"},Us={class:"modal-title",id:"orgDetailsModalLabel"},ws={class:"modal-body"},xs={key:0},ks={class:"mb-3"},Os={key:0,class:"text-center p-3 border rounded"},As={key:1,class:"table-responsive"},Ms={class:"table table-sm"},Cs=["onClick"],Ds={class:"modal fade",id:"assignUserModal",tabindex:"-1","aria-labelledby":"assignUserModalLabel","aria-hidden":"true"},Es={class:"modal-dialog"},Ns={class:"modal-content"},Ts={class:"modal-body"},Fs={class:"mb-3"},Ls=["value"],js={class:"mb-3"},Is=["value"],Ss={class:"modal-footer"};function Bs(f,t,c,n,h,v){return l(),a("div",V,[s("div",q,[s("div",H,[s("div",J,[t[7]||(t[7]=s("div",null,[s("h2",{class:"mb-0"},[s("i",{class:"bi bi-people me-2"}),b(" Organization User Assignments ")]),s("p",{class:"text-muted mb-0"},"Manage user assignments to organizations")],-1)),s("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...e)=>n.openAssignUserModal&&n.openAssignUserModal(...e))},t[6]||(t[6]=[s("i",{class:"bi bi-plus-circle me-2"},null,-1),b(" Assign User to Organization ")]))]),s("div",P,[s("div",G,[s("div",K,[s("div",Q,[s("div",W,[t[9]||(t[9]=s("i",{class:"bi bi-building me-3",style:{"font-size":"2rem"}},null,-1)),s("div",null,[s("h4",X,d(n.organizations.length),1),t[8]||(t[8]=s("small",null,"Total Organizations",-1))])])])])]),s("div",Y,[s("div",Z,[s("div",$,[s("div",ss,[t[11]||(t[11]=s("i",{class:"bi bi-person-check me-3",style:{"font-size":"2rem"}},null,-1)),s("div",null,[s("h4",ts,d(n.totalAssignments),1),t[10]||(t[10]=s("small",null,"Total Assignments",-1))])])])])]),s("div",es,[s("div",ns,[s("div",is,[s("div",os,[t[13]||(t[13]=s("i",{class:"bi bi-people me-3",style:{"font-size":"2rem"}},null,-1)),s("div",null,[s("h4",as,d(n.users.length),1),t[12]||(t[12]=s("small",null,"Total Users",-1))])])])])])]),s("div",ls,[t[19]||(t[19]=s("div",{class:"card-header"},[s("h5",{class:"card-title mb-0"},[s("i",{class:"bi bi-building me-2"}),b(" Organizations & User Assignments ")])],-1)),s("div",rs,[n.loading?(l(),a("div",ds,t[14]||(t[14]=[s("div",{class:"spinner-border",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1)]))):(l(),a("div",cs,[s("table",ms,[t[18]||(t[18]=s("thead",{class:"table-light"},[s("tr",null,[s("th",null,"Organization"),s("th",null,"Assigned Users"),s("th",null,"Actions")])],-1)),s("tbody",null,[(l(!0),a(p,null,y(n.organizations,e=>(l(),a("tr",{key:e.id},[s("td",null,[s("div",us,[s("div",{class:"me-2",style:B(`width: 12px; height: 12px; background-color: ${e.color}; border-radius: 50%;`)},null,4),s("div",null,[s("strong",null,d(e.name),1),t[15]||(t[15]=s("br",null,null,-1)),s("small",gs,d(e.description||"No description"),1)])])]),s("td",null,[n.getOrgUsers(e.id).length===0?(l(),a("div",bs," No users assigned ")):(l(),a("div",vs,[(l(!0),a(p,null,y(n.getOrgUsers(e.id),u=>(l(),a("span",{key:u.id,class:"badge bg-secondary me-1 mb-1"},d(u.username),1))),128))]))]),s("td",null,[s("button",{class:"btn btn-sm btn-outline-primary",onClick:u=>n.viewOrgDetails(e),title:"View Details"},t[16]||(t[16]=[s("i",{class:"bi bi-eye"},null,-1)]),8,_s),s("button",{class:"btn btn-sm btn-outline-success",onClick:u=>n.openAssignUserModal(e),title:"Assign User"},t[17]||(t[17]=[s("i",{class:"bi bi-person-plus"},null,-1)]),8,ps)])]))),128))])])]))])])])]),s("div",ys,[s("div",fs,[s("div",hs,[s("div",zs,[s("h5",Us,[t[20]||(t[20]=s("i",{class:"bi bi-building me-2"},null,-1)),b(" "+d(n.selectedOrg?.name)+" - User Assignments ",1)]),t[21]||(t[21]=s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),s("div",ws,[n.selectedOrg?(l(),a("div",xs,[s("div",ks,[s("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=e=>n.openAssignUserModal(n.selectedOrg))},t[22]||(t[22]=[s("i",{class:"bi bi-person-plus me-2"},null,-1),b(" Assign New User ")]))]),n.orgUsers.length===0?(l(),a("div",Os,t[23]||(t[23]=[s("i",{class:"bi bi-person-x text-muted",style:{"font-size":"2rem"}},null,-1),s("p",{class:"text-muted mt-2 mb-0"},"No users assigned to this organization",-1)]))):(l(),a("div",As,[s("table",Ms,[t[25]||(t[25]=s("thead",null,[s("tr",null,[s("th",null,"Username"),s("th",null,"Email"),s("th",null,"Assigned Date"),s("th",null,"Actions")])],-1)),s("tbody",null,[(l(!0),a(p,null,y(n.orgUsers,e=>(l(),a("tr",{key:e.id},[s("td",null,d(e.username),1),s("td",null,d(e.email||"-"),1),s("td",null,d(n.formatDate(e.assigned_at)),1),s("td",null,[s("button",{class:"btn btn-sm btn-outline-danger",onClick:u=>n.removeUserFromOrg(e.id)},t[24]||(t[24]=[s("i",{class:"bi bi-trash"},null,-1)]),8,Cs)])]))),128))])])]))])):I("",!0)]),t[26]||(t[26]=s("div",{class:"modal-footer"},[s("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])]),s("div",Ds,[s("div",Es,[s("div",Ns,[t[32]||(t[32]=s("div",{class:"modal-header"},[s("h5",{class:"modal-title",id:"assignUserModalLabel"},"Assign User to Organization"),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),s("div",Ts,[s("form",{onSubmit:t[4]||(t[4]=S((...e)=>n.assignUser&&n.assignUser(...e),["prevent"]))},[s("div",Fs,[t[28]||(t[28]=s("label",{for:"selectedOrg",class:"form-label"},[b("Organization "),s("span",{class:"text-danger"},"*")],-1)),O(s("select",{class:"form-select",id:"selectedOrg","onUpdate:modelValue":t[2]||(t[2]=e=>n.assignmentForm.organization_id=e),required:""},[t[27]||(t[27]=s("option",{value:""},"Select Organization",-1)),(l(!0),a(p,null,y(n.organizations,e=>(l(),a("option",{key:e.id,value:e.id},d(e.name),9,Ls))),128))],512),[[A,n.assignmentForm.organization_id]])]),s("div",js,[t[30]||(t[30]=s("label",{for:"selectedUser",class:"form-label"},[b("User "),s("span",{class:"text-danger"},"*")],-1)),O(s("select",{class:"form-select",id:"selectedUser","onUpdate:modelValue":t[3]||(t[3]=e=>n.assignmentForm.user_id=e),required:""},[t[29]||(t[29]=s("option",{value:""},"Select User",-1)),(l(!0),a(p,null,y(n.availableUsers,e=>(l(),a("option",{key:e.id,value:e.id},d(e.username)+" "+d(e.email?`(${e.email})`:""),9,Is))),128))],512),[[A,n.assignmentForm.user_id]])])],32)]),s("div",Ss,[t[31]||(t[31]=s("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),s("button",{type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=(...e)=>n.assignUser&&n.assignUser(...e))},"Assign User")])])])])])}const qs=L(R,[["render",Bs],["__scopeId","data-v-060c6372"]]);export{qs as default};
//# sourceMappingURL=organizationAssignments-DgctGOXH.js.map
