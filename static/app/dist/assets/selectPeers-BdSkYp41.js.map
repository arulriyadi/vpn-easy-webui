{"version":3,"file":"selectPeers-BdSkYp41.js","sources":["../../src/components/configurationComponents/selectPeers.vue"],"sourcesContent":["<script setup>\nimport LocaleText from \"@/components/text/localeText.vue\";\nimport {computed, reactive, ref, useTemplateRef, watch} from \"vue\";\nimport {fetchGet, fetchPost} from \"@/utilities/fetch.js\";\nimport {useRoute} from \"vue-router\";\nimport {DashboardConfigurationStore} from \"@/stores/DashboardConfigurationStore.js\";\n\nconst props = defineProps({\n\tconfigurationPeers: Array\n})\nconst deleteConfirmation = ref(false)\nconst downloadConfirmation = ref(false)\nconst selectedPeers = ref([])\nconst selectPeersSearchInput = ref(\"\")\n\nconst togglePeers = (id) => {\n\tif (selectedPeers.value.find(x => x === id)){\n\t\tselectedPeers.value = selectedPeers.value.filter(x => x !== id)\n\t}else{\n\t\tselectedPeers.value.push(id)\n\t}\n}\n\nconst searchPeers = computed(() => {\n\tif (deleteConfirmation.value || downloadConfirmation.value){\n\t\treturn props.configurationPeers.filter(x =>\n\t\t\tselectedPeers.value.find(y => y === x.id)\n\t\t)\n\t}\n\tif (selectPeersSearchInput.value.length > 0){\n\t\treturn props.configurationPeers.filter(x => {\n\t\t\treturn x.id.includes(selectPeersSearchInput.value) || x.name.includes(selectPeersSearchInput.value)\n\t\t})\n\t}\n\treturn props.configurationPeers\n})\n\nwatch(selectedPeers, () => {\n\tif (selectedPeers.value.length === 0){\n\t\tdeleteConfirmation.value = false;\n\t\tdownloadConfirmation.value = false;\n\t}\n})\n\nconst route = useRoute()\nconst dashboardStore = DashboardConfigurationStore()\nconst emit = defineEmits([\"refresh\", \"close\"])\nconst submitting = ref(false)\nconst submitDelete = () => {\n\tsubmitting.value = true;\n\tfetchPost(`/api/deletePeers/${route.params.id}`, {\n\t\tpeers: selectedPeers.value\n\t}, (res) => {\n\t\tdashboardStore.newMessage(\"Server\", res.message, res.status ? \"success\":\"danger\")\n\t\tif (res.status){\n\t\t\tselectedPeers.value = []\n\t\t\tdeleteConfirmation.value = false\n\t\t}\n\t\temit(\"refresh\")\n\t\tsubmitting.value = false;\n\t})\n}\n\nconst downloaded = reactive({\n\tsuccess: [],\n\tfailed: []\n})\nconst cardBody = useTemplateRef('card-body');\nconst el = useTemplateRef(\"sp\")\nconst submitDownload = async () => {\n\tdownloadConfirmation.value = true\n\tfor (const x of selectedPeers.value) {\n\t\tcardBody.value.scrollTo({\n\t\t\ttop: el.value.find(y => y.dataset.id === x).offsetTop - 20,\n\t\t\tbehavior: 'smooth'\n\t\t})\n\t\tawait fetchGet(\"/api/downloadPeer/\"+route.params.id, {\n\t\t\tid: x\n\t\t}, (res) => {\n\t\t\tif (res.status){\n\t\t\t\tconst blob = new Blob([res.data.file], { type: \"text/plain\" });\n\t\t\t\tconst jsonObjectUrl = URL.createObjectURL(blob);\n\t\t\t\tconst filename = `${res.data.fileName}.conf`;\n\t\t\t\tconst anchorEl = document.createElement(\"a\");\n\t\t\t\tanchorEl.href = jsonObjectUrl;\n\t\t\t\tanchorEl.download = filename;\n\t\t\t\tanchorEl.click();\n\t\t\t\tdownloaded.success.push(x)\n\t\t\t}else{\n\t\t\t\tdownloaded.failed.push(x)\n\t\t\t}\n\t\t})\n\t}\n}\nconst clearDownload = () => {\n\tdownloaded.success = []\n\tdownloaded.failed = []\n\tdownloadConfirmation.value = false;\n}\n</script>\n\n<template>\n\t<div class=\"peerSettingContainer w-100 h-100 position-absolute top-0 start-0 overflow-y-scroll\" ref=\"selectPeersContainer\">\n\t\t<div class=\"container d-flex h-100 w-100\">\n\t\t\t<div class=\"m-auto modal-dialog-centered dashboardModal\" style=\"width: 700px\">\n\t\t\t\t<div class=\"card rounded-3 shadow flex-grow-1\">\n\t\t\t\t\t<div class=\"card-header bg-transparent d-flex align-items-center gap-2 p-4 flex-column pb-3\">\n\t\t\t\t\t\t<div class=\"mb-2 w-100 d-flex\">\n\t\t\t\t\t\t\t<h4 class=\"mb-0\">\n\t\t\t\t\t\t\t\t<LocaleText t=\"Select Peers\"></LocaleText>\n\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t<button type=\"button\" class=\"btn-close ms-auto\"\n\t\t\t\t\t\t\t        @click=\"emit('close')\"></button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"d-flex w-100 align-items-center gap-2\">\n\t\t\t\t\t\t\t<div class=\"d-flex gap-3\">\n\t\t\t\t\t\t\t\t<a role=\"button\"\n\t\t\t\t\t\t\t\t   v-if=\"!downloadConfirmation && selectedPeers.length !== configurationPeers.map(x => x.id).length\"\n\t\t\t\t\t\t\t\t   @click=\"selectedPeers = configurationPeers.map(x => x.id)\"\n\t\t\t\t\t\t\t\t   class=\"text-decoration-none text-body\">\n\t\t\t\t\t\t\t\t\t<small>\n\t\t\t\t\t\t\t\t\t\t<i class=\"bi bi-check-all me-2\"></i>\n\t\t\t\t\t\t\t\t\t\t<LocaleText t=\"Select All\"></LocaleText>\n\t\t\t\t\t\t\t\t\t</small>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t<a role=\"button\" class=\"text-decoration-none text-body\"\n\t\t\t\t\t\t\t\t   @click=\"selectedPeers = []\"\n\t\t\t\t\t\t\t\t   v-if=\"selectedPeers.length > 0 && !downloadConfirmation\">\n\t\t\t\t\t\t\t\t\t<small>\n\t\t\t\t\t\t\t\t\t\t<i class=\"bi bi-x-circle-fill me-2\"></i>\n\t\t\t\t\t\t\t\t\t\t<LocaleText t=\"Clear Selection\"></LocaleText>\n\t\t\t\t\t\t\t\t\t</small>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<label class=\"ms-auto\" for=\"selectPeersSearchInput\">\n\t\t\t\t\t\t\t\t<i class=\"bi bi-search\"></i>\t\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t<input class=\"form-control form-control-sm rounded-3\"\n\t\t\t\t\t\t\t       v-model=\"selectPeersSearchInput\"\n\t\t\t\t\t\t\t       id=\"selectPeersSearchInput\"\n\t\t\t\t\t\t\t       style=\"width: 200px !important;\" type=\"text\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"card-body px-4 flex-grow-1 d-flex gap-2 flex-column position-relative\" \n\t\t\t\t\t     ref=\"card-body\"\n\t\t\t\t\t     style=\"overflow-y: scroll\">\n\t\t\t\t\t\t<button type=\"button\" class=\"btn w-100 peerBtn text-start rounded-3 d-flex align-items-center gap-3\"\n\t\t\t\t\t\t        @click=\"togglePeers(p.id)\"\n\t\t\t\t\t\t        :class=\"{active: selectedPeers.find(x => x === p.id)}\"\n\t\t\t\t\t\t        :key=\"p.id\"\n\t\t\t\t\t\t        :disabled=\"deleteConfirmation || downloadConfirmation\"\n\t\t\t\t\t\t        ref=\"sp\"\n\t\t\t\t\t\t        :data-id=\"p.id\"\n\t\t\t\t\t\t        v-for=\"p in searchPeers\">\n\t\t\t\t\t\t\t<span v-if=\"!downloadConfirmation\">\n\t\t\t\t\t\t\t\t\t<i class=\"bi\"\n\t\t\t\t\t\t\t\t\t   :class=\"[ selectedPeers.find(x => x === p.id) ? 'bi-check-circle-fill':'bi-circle']\"\n\t\t\t\t\t\t\t\t\t></i>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span class=\"d-flex flex-column\">\n\t\t\t\t\t\t\t\t<small class=\"fw-bold\">\n\t\t\t\t\t\t\t\t\t{{p.name ? p.name : \"Untitled Peer\"}}\n\t\t\t\t\t\t\t\t</small>\n\t\t\t\t\t\t\t\t<small class=\"text-muted\">\n\t\t\t\t\t\t\t\t\t<samp>{{p.id}}</samp>\n\t\t\t\t\t\t\t\t</small>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span v-if=\"downloadConfirmation\" class=\"ms-auto\">\n\t\t\t\t\t\t\t\t<span class=\"spinner-border spinner-border-sm\" role=\"status\"\n\t\t\t\t\t\t\t\t     v-if=\"!downloaded.success.find(x => x === p.id) && !downloaded.failed.find(x => x === p.id)\">\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<i class=\"bi\"\n\t\t\t\t\t\t\t\t   v-else\n\t\t\t\t\t\t\t\t   :class=\"[downloaded.failed.find(x => x === p.id) ? 'bi-x-circle-fill':'bi-check-circle-fill']\"\n\t\t\t\t\t\t\t\t></i>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"card-footer px-4 py-3 gap-2 d-flex align-items-center\">\n\t\t\t\t\t\t<template v-if=\"!deleteConfirmation && !downloadConfirmation\">\n\t\t\t\t\t\t\t<button class=\"btn bg-primary-subtle text-primary-emphasis border-primary-subtle rounded-3\"\n\t\t\t\t\t\t\t        :disabled=\"selectedPeers.length === 0 || submitting\"\n\t\t\t\t\t\t\t        @click=\"submitDownload()\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<i class=\"bi bi-download\"></i>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<span v-if=\"selectedPeers.length > 0\" class=\"flex-grow-1 text-center\">\n\t\t\t\t\t\t\t\t<i class=\"bi bi-check-circle-fill me-2\"></i>\n\t\t\t\t\t\t\t\t<LocaleText :t=\"selectedPeers.length + ' Peer' + (selectedPeers.length > 1 ? 's':'')\"></LocaleText>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<button class=\"btn bg-danger-subtle text-danger-emphasis border-danger-subtle ms-auto rounded-3\"\n\t\t\t\t\t\t\t        @click=\"deleteConfirmation = true\"\n\t\t\t\t\t\t\t        :disabled=\"selectedPeers.length === 0 || submitting\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<i class=\"bi bi-trash\"></i>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else-if=\"downloadConfirmation\">\n\t\t\t\t\t\t\t<strong v-if=\"downloaded.failed.length + downloaded.success.length < selectedPeers.length\" class=\"flex-grow-1 text-center\">\n\t\t\t\t\t\t\t\t<LocaleText t=\"Downloading\" /> <LocaleText :t=\"selectedPeers.length + ' Peer' + (selectedPeers.length > 1 ? 's':'')\"></LocaleText>...\n\t\t\t\t\t\t\t</strong>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<strong>\n\t\t\t\t\t\t\t\t\t<LocaleText t=\"Download Finished\"></LocaleText>\n\t\t\t\t\t\t\t\t</strong>\n\t\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\t\t@click=\"clearDownload()\"\n\t\t\t\t\t\t\t\t\tclass=\"btn bg-secondary-subtle text-secondary-emphasis border border-secondary-subtle rounded-3 ms-auto\">\n\t\t\t\t\t\t\t\t\t<LocaleText t=\"Done\"></LocaleText>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template v-else-if=\"deleteConfirmation\">\n\t\t\t\t\t\t\t<button class=\"btn btn-danger rounded-3\"\n\t\t\t\t\t\t\t        :disabled=\"selectedPeers.length === 0 || submitting\"\n\t\t\t\t\t\t\t        @click=\"submitDelete()\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<LocaleText t=\"Yes\"></LocaleText>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<strong v-if=\"selectedPeers.length > 0\" class=\"flex-grow-1 text-center\">\n\t\t\t\t\t\t\t\t<LocaleText t=\"Are you sure to delete\"></LocaleText> <LocaleText :t=\"selectedPeers.length + ' Peer' + (selectedPeers.length > 1 ? 's':'')\"></LocaleText>?\n\t\t\t\t\t\t\t</strong>\n\t\t\t\t\t\t\t<button class=\"btn bg-secondary-subtle text-secondary-emphasis border border-secondary-subtle ms-auto rounded-3\"\n\t\t\t\t\t\t\t        :disabled=\"selectedPeers.length === 0 || submitting\"\n\t\t\t\t\t\t\t        @click=\"deleteConfirmation = false\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<LocaleText t=\"No\"></LocaleText>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n\n<style scoped>\n\t.card{\n\t\theight: 100%;\n\t}\n\t\n\t.dashboardModal{\n\t\theight: calc(100% - 1rem) !important;\n\t}\n\t\n\t@media screen and (min-height: 700px) {\n\t\t.card{\n\t\t\theight: 700px;\n\t\t}\n\t}\n\t\n\t.peerBtn{\n\t\tborder: var(--bs-border-width) solid var(--bs-border-color);\n\t}\n\t.peerBtn.active{\n\t\tborder: var(--bs-border-width) solid var(--bs-body-color);\n\t}\n\t\n</style>"],"names":["props","__props","deleteConfirmation","ref","downloadConfirmation","selectedPeers","selectPeersSearchInput","togglePeers","id","x","searchPeers","computed","y","watch","route","useRoute","dashboardStore","DashboardConfigurationStore","emit","__emit","submitting","submitDelete","fetchPost","res","downloaded","reactive","cardBody","useTemplateRef","el","submitDownload","fetchGet","blob","jsonObjectUrl","filename","anchorEl","clearDownload"],"mappings":"26CAOA,MAAMA,EAAQC,EAGRC,EAAqBC,EAAI,EAAK,EAC9BC,EAAuBD,EAAI,EAAK,EAChCE,EAAgBF,EAAI,EAAE,EACtBG,EAAyBH,EAAI,EAAE,EAE/BI,EAAeC,GAAO,CACvBH,EAAc,MAAM,KAAKI,GAAKA,IAAMD,CAAE,EACzCH,EAAc,MAAQA,EAAc,MAAM,OAAOI,GAAKA,IAAMD,CAAE,EAE9DH,EAAc,MAAM,KAAKG,CAAE,CAE7B,EAEME,EAAcC,EAAS,IACxBT,EAAmB,OAASE,EAAqB,MAC7CJ,EAAM,mBAAmB,OAAOS,GACtCJ,EAAc,MAAM,KAAKO,GAAKA,IAAMH,EAAE,EAAE,CACxC,EAEEH,EAAuB,MAAM,OAAS,EAClCN,EAAM,mBAAmB,OAAOS,GAC/BA,EAAE,GAAG,SAASH,EAAuB,KAAK,GAAKG,EAAE,KAAK,SAASH,EAAuB,KAAK,CAClG,EAEKN,EAAM,kBACb,EAEDa,EAAMR,EAAe,IAAM,CACtBA,EAAc,MAAM,SAAW,IAClCH,EAAmB,MAAQ,GAC3BE,EAAqB,MAAQ,GAE/B,CAAC,EAED,MAAMU,EAAQC,EAAU,EAClBC,EAAiBC,EAA6B,EAC9CC,EAAOC,EACPC,EAAajB,EAAI,EAAK,EACtBkB,EAAe,IAAM,CAC1BD,EAAW,MAAQ,GACnBE,EAAU,oBAAoBR,EAAM,OAAO,EAAE,GAAI,CAChD,MAAOT,EAAc,KACrB,EAAGkB,GAAQ,CACXP,EAAe,WAAW,SAAUO,EAAI,QAASA,EAAI,OAAS,UAAU,QAAQ,EAC5EA,EAAI,SACPlB,EAAc,MAAQ,CAAE,EACxBH,EAAmB,MAAQ,IAE5BgB,EAAK,SAAS,EACdE,EAAW,MAAQ,EACrB,CAAE,CACF,EAEMI,EAAaC,EAAS,CAC3B,QAAS,CAAE,EACX,OAAQ,CAAE,CACX,CAAC,EACKC,EAAWC,EAAe,WAAW,EACrCC,EAAKD,EAAe,IAAI,EACxBE,EAAiB,SAAY,CAClCzB,EAAqB,MAAQ,GAC7B,UAAWK,KAAKJ,EAAc,MAC7BqB,EAAS,MAAM,SAAS,CACvB,IAAKE,EAAG,MAAM,KAAKhB,GAAKA,EAAE,QAAQ,KAAOH,CAAC,EAAE,UAAY,GACxD,SAAU,QACb,CAAG,EACD,MAAMqB,EAAS,qBAAqBhB,EAAM,OAAO,GAAI,CACpD,GAAIL,CACJ,EAAGc,GAAQ,CACX,GAAIA,EAAI,OAAO,CACd,MAAMQ,EAAO,IAAI,KAAK,CAACR,EAAI,KAAK,IAAI,EAAG,CAAE,KAAM,YAAY,CAAE,EACvDS,EAAgB,IAAI,gBAAgBD,CAAI,EACxCE,EAAW,GAAGV,EAAI,KAAK,QAAQ,QAC/BW,EAAW,SAAS,cAAc,GAAG,EAC3CA,EAAS,KAAOF,EAChBE,EAAS,SAAWD,EACpBC,EAAS,MAAK,EACdV,EAAW,QAAQ,KAAKf,CAAC,CAC7B,MACIe,EAAW,OAAO,KAAKf,CAAC,CAE5B,CAAG,CAEH,EACM0B,EAAgB,IAAM,CAC3BX,EAAW,QAAU,CAAE,EACvBA,EAAW,OAAS,CAAE,EACtBpB,EAAqB,MAAQ,EAC9B"}