import{_ as D,D as L,g as U,a,c as l,b as t,d as o,w as b,n as d,t as u,f as p,i as w,e as _,z as T,B as F,p as G,k as h,x as $,y as R,A as K,W as O,G as x,j as I,T as M,F as k,m as C}from"./index-BHlSp020.js";import{L as P}from"./localeText-CiGT51Jl.js";import{_ as W}from"./protocolBadge-DE7YK6wu.js";const N={name:"configurationCard",components:{ProtocolBadge:W,LocaleText:P},props:{c:{Name:String,Status:Boolean,PublicKey:String,PrivateKey:String},delay:String,display:String},data(){return{configurationToggling:!1}},setup(){return{dashboardConfigurationStore:L()}},methods:{toggle(){this.configurationToggling=!0,U("/api/toggleWireguardConfiguration",{configurationName:this.c.Name},s=>{s.status?this.dashboardConfigurationStore.newMessage("Server",`${this.c.Name} ${s.data?"is on":"is off"}`):this.dashboardConfigurationStore.newMessage("Server",s.message,"danger"),this.c.Status=s.data,this.configurationToggling=!1})}}},V=()=>{G(s=>({"7d032b58":s.delay}))},B=N.setup;N.setup=B?(s,e)=>(V(),B(s,e)):V;const E={class:"card conf_card rounded-3 shadow text-decoration-none"},J={class:"mb-0"},j={class:"card-title mb-0 d-flex align-items-center gap-2"},z={class:"card-footer d-flex gap-2 flex-column"},A={class:"row"},Q={class:"d-flex gap-2 align-items-center"},Y={class:"text-muted"},q={class:"mb-0 d-block d-lg-inline-block"},H={style:{"line-break":"anywhere"}},X={class:"form-check form-switch ms-auto"},Z=["for"],tt={key:4,class:"spinner-border spinner-border-sm ms-2","aria-hidden":"true"},et=["disabled","id"];function st(s,e,i,S,f,g){const n=h("ProtocolBadge"),m=h("RouterLink"),c=h("LocaleText");return a(),l("div",{class:d(["col-12",{"col-lg-6 col-xl-4":this.display==="Grid"}])},[t("div",E,[o(m,{to:"/configuration/"+i.c.Name+"/peers",class:"card-body d-flex align-items-center gap-3 flex-wrap text-decoration-none"},{default:b(()=>[t("h6",J,[t("span",{class:d(["dot",{active:i.c.Status}])},null,2)]),t("h6",j,[t("samp",null,u(i.c.Name),1),t("small",null,[o(n,{protocol:i.c.Protocol,mini:!0},null,8,["protocol"])])]),e[2]||(e[2]=t("h6",{class:"mb-0 ms-auto"},[t("i",{class:"bi bi-chevron-right"})],-1))]),_:1},8,["to"]),t("div",z,[t("div",A,[t("small",{class:d(["col-6",{"col-md-3":this.display==="List"}])},[e[3]||(e[3]=t("i",{class:"bi bi-arrow-down-up me-2"},null,-1)),p(u(i.c.DataUsage.Total>0?i.c.DataUsage.Total.toFixed(4):0)+" GB ",1)],2),t("small",{class:d(["text-primary-emphasis col-6",{"col-md-3":this.display==="List"}])},[e[4]||(e[4]=t("i",{class:"bi bi-arrow-down me-2"},null,-1)),p(u(i.c.DataUsage.Receive>0?i.c.DataUsage.Receive.toFixed(4):0)+" GB ",1)],2),t("small",{class:d(["text-success-emphasis col-6",{"col-md-3":this.display==="List"}])},[e[5]||(e[5]=t("i",{class:"bi bi-arrow-up me-2"},null,-1)),p(u(i.c.DataUsage.Sent>0?i.c.DataUsage.Sent.toFixed(4):0)+" GB ",1)],2),t("small",{class:d(["col-6",{"col-md-3 text-md-end ":this.display==="List"}])},[t("span",{class:d(["dot me-2",{active:i.c.ConnectedPeers>0}])},null,2),p(" "+u(i.c.ConnectedPeers)+" / "+u(i.c.TotalPeers)+" ",1),o(c,{t:"Peers"})],2)]),t("div",{class:d(["d-flex gap-2",[this.display==="Grid"?"flex-column":"gap-lg-3 flex-column flex-lg-row"]])},[t("div",Q,[t("small",Y,[t("strong",null,[o(c,{t:"Public Key"})])]),t("small",q,[t("samp",H,u(i.c.PublicKey),1)])]),t("div",X,[t("label",{class:"form-check-label",style:{cursor:"pointer"},for:"switch"+i.c.PrivateKey},[!i.c.Status&&this.configurationToggling?(a(),w(c,{key:0,t:"Turning Off..."})):i.c.Status&&this.configurationToggling?(a(),w(c,{key:1,t:"Turning On..."})):i.c.Status&&!this.configurationToggling?(a(),w(c,{key:2,t:"On"})):!i.c.Status&&!this.configurationToggling?(a(),w(c,{key:3,t:"Off"})):_("",!0),this.configurationToggling?(a(),l("span",tt)):_("",!0)],8,Z),T(t("input",{class:"form-check-input",style:{cursor:"pointer"},disabled:this.configurationToggling,type:"checkbox",role:"switch",id:"switch"+i.c.PrivateKey,onChange:e[0]||(e[0]=v=>this.toggle()),"onUpdate:modelValue":e[1]||(e[1]=v=>i.c.Status=v)},null,40,et),[[F,i.c.Status]])])],2)])])],2)}const it=D(N,[["render",st],["__scopeId","data-v-dafd6275"]]),ot={components:{LocaleText:P},props:{targetData:String,title:String,warning:!1,warningText:""},setup(){const s=L(),e=`input_${$()}`;return{store:s,uuid:e}},data(){return{value:"",invalidFeedback:"",showInvalidFeedback:!1,isValid:!1,timeout:void 0,changed:!1,updating:!1}},mounted(){this.value=this.store.Configuration.Peers[this.targetData]},methods:{async useValidation(){this.changed&&await R("/api/updateDashboardConfigurationItem",{section:"Peers",key:this.targetData,value:this.value},s=>{s.status?(this.isValid=!0,this.showInvalidFeedback=!1,this.store.Configuration.Peers[this.targetData]=this.value,clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.isValid=!1,5e3)):(this.isValid=!1,this.showInvalidFeedback=!0,this.invalidFeedback=s.message),this.changed=!1,this.updating=!1})}}},at={class:"form-group mb-2"},nt=["for"],rt=["id","disabled"],lt={class:"invalid-feedback"},dt={key:0,class:"px-2 py-1 text-warning-emphasis bg-warning-subtle border border-warning-subtle rounded-2 d-inline-block mt-1"};function ct(s,e,i,S,f,g){const n=h("LocaleText");return a(),l("div",at,[t("label",{for:this.uuid,class:"text-muted mb-1"},[t("strong",null,[t("small",null,[o(n,{t:this.title},null,8,["t"])])])],8,nt),T(t("input",{type:"text",class:d(["form-control",{"is-invalid":f.showInvalidFeedback,"is-valid":f.isValid}]),id:this.uuid,"onUpdate:modelValue":e[0]||(e[0]=m=>this.value=m),onKeydown:e[1]||(e[1]=m=>this.changed=!0),onBlur:e[2]||(e[2]=m=>g.useValidation()),disabled:this.updating},null,42,rt),[[K,this.value]]),t("div",lt,u(this.invalidFeedback),1),i.warning?(a(),l("div",dt,[t("small",null,[e[3]||(e[3]=t("i",{class:"bi bi-exclamation-triangle-fill me-2"},null,-1)),o(n,{t:i.warningText},null,8,["t"])])])):_("",!0)])}const ut=D(ot,[["render",ct]]),gt={name:"configurationList",components:{LocaleText:P,ConfigurationCard:it,PeersDefaultSettingsInput:ut},async setup(){const s=O(),e=L();return{wireguardConfigurationsStore:s,dashboardConfigurationStore:e}},data(){return{configurationLoaded:!1,sort:{Name:x("Name"),Status:x("Status"),"DataUsage.Total":x("Total Usage")},currentSort:{key:"Name",order:"asc"},currentDisplay:"List",searchKey:"",showPeerSettings:!1}},async mounted(){window.localStorage.getItem("ConfigurationListSort")?this.currentSort=JSON.parse(window.localStorage.getItem("ConfigurationListSort")):window.localStorage.setItem("ConfigurationListSort",JSON.stringify(this.currentSort)),window.localStorage.getItem("ConfigurationListDisplay")?this.currentDisplay=window.localStorage.getItem("ConfigurationListDisplay"):window.localStorage.setItem("ConfigurationListDisplay",this.currentDisplay),await this.wireguardConfigurationsStore.getConfigurations(),this.configurationLoaded=!0,this.wireguardConfigurationsStore.ConfigurationListInterval=setInterval(()=>{this.wireguardConfigurationsStore.getConfigurations()},1e4)},beforeUnmount(){clearInterval(this.wireguardConfigurationsStore.ConfigurationListInterval)},computed:{configurations(){return[...this.wireguardConfigurationsStore.Configurations].filter(s=>s.Name.toLowerCase().includes(this.searchKey)||s.PublicKey.includes(this.searchKey)||!this.searchKey).sort((s,e)=>this.currentSort.order==="desc"?this.dotNotation(s,this.currentSort.key)<this.dotNotation(e,this.currentSort.key)?1:this.dotNotation(s,this.currentSort.key)>this.dotNotation(e,this.currentSort.key)?-1:0:this.dotNotation(s,this.currentSort.key)>this.dotNotation(e,this.currentSort.key)?1:this.dotNotation(s,this.currentSort.key)<this.dotNotation(e,this.currentSort.key)?-1:0)}},methods:{dotNotation(s,e){let i=e.split(".").reduce((S,f)=>S&&S[f],s);return typeof i=="string"?i.toLowerCase():i},updateSort(s){this.currentSort.key===s?this.currentSort.order==="asc"?this.currentSort.order="desc":this.currentSort.order="asc":this.currentSort.key=s,window.localStorage.setItem("ConfigurationListSort",JSON.stringify(this.currentSort))},updateDisplay(s){this.currentDisplay!==s&&(this.currentDisplay=s,window.localStorage.setItem("ConfigurationListDisplay",this.currentDisplay))},togglePeerSettings(){this.showPeerSettings=!this.showPeerSettings}}},mt={class:"mt-md-5 mt-3"},ht={class:"container-fluid"},ft={class:"d-flex mb-4 configurationListTitle align-items-md-center gap-2 flex-column flex-md-row"},_t={class:"text-body d-flex mb-0"},yt={key:0,class:"card mb-4"},bt={class:"card-header"},pt={class:"my-2 d-flex align-items-center"},St={class:"card-body"},wt={class:"row g-3"},vt={class:"col-md-6"},xt={class:"col-md-6"},kt={class:"col-md-6"},Ct={class:"col-md-6"},Dt={class:"col-12"},Lt={key:0,class:"text-body filter mb-3 d-flex gap-2 flex-column flex-md-row"},Tt={class:"d-flex align-items-center gap-3 align-items-center mb-3 mb-md-0"},Pt={class:"text-muted"},Nt={class:"d-flex ms-auto ms-lg-0"},It=["onClick"],Vt={class:"align-items-center gap-3 align-items-center mb-3 mb-md-0 d-none d-lg-flex"},Bt={class:"text-muted"},Kt={class:"d-flex ms-auto ms-lg-0"},Ut=["onClick"],Ft={class:"d-flex align-items-center ms-md-auto"},Gt={class:"row g-3 mb-2"},$t={class:"text-muted col-12",key:"noConfiguration"};function Rt(s,e,i,S,f,g){const n=h("LocaleText"),m=h("RouterLink"),c=h("PeersDefaultSettingsInput"),v=h("ConfigurationCard");return a(),l("div",mt,[t("div",ht,[t("div",ft,[t("h2",_t,[o(n,{t:"WireGuard Configurations"})]),o(m,{to:"/new_configuration",class:"ms-md-auto py-2 text-decoration-none btn text-primary-emphasis bg-primary-subtle rounded-3 border-1 border-primary-subtle"},{default:b(()=>[e[2]||(e[2]=t("i",{class:"bi bi-plus-circle me-2"},null,-1)),o(n,{t:"Configuration"})]),_:1}),o(m,{to:"/restore_configuration",class:"py-2 text-decoration-none btn text-primary-emphasis bg-primary-subtle rounded-3 border-1 border-primary-subtle"},{default:b(()=>[e[3]||(e[3]=t("i",{class:"bi bi-clock-history me-2"},null,-1)),o(n,{t:"Restore"})]),_:1}),t("button",{onClick:e[0]||(e[0]=(...r)=>g.togglePeerSettings&&g.togglePeerSettings(...r)),class:"py-2 text-decoration-none btn text-secondary-emphasis bg-secondary-subtle rounded-3 border-1 border-secondary-subtle"},[e[4]||(e[4]=t("i",{class:"bi bi-gear me-2"},null,-1)),o(n,{t:"Peer Settings"})])]),o(I,{name:"slide-down"},{default:b(()=>[f.showPeerSettings?(a(),l("div",yt,[t("div",bt,[t("h6",pt,[e[5]||(e[5]=t("i",{class:"bi bi-gear me-2"},null,-1)),o(n,{t:"Peer Default Settings"})])]),t("div",St,[t("div",wt,[t("div",vt,[o(c,{targetData:"peer_global_dns",title:"DNS"})]),t("div",xt,[o(c,{targetData:"peer_endpoint_allowed_ip",title:"Endpoint Allowed IPs"})]),t("div",kt,[o(c,{targetData:"peer_mtu",title:"MTU"})]),t("div",Ct,[o(c,{targetData:"peer_keep_alive",title:"Persistent Keepalive"})]),t("div",Dt,[o(c,{targetData:"remote_endpoint",title:"Peer Remote Endpoint",warning:!0,warningText:"This will be changed globally, and will be apply to all peer's QR code and configuration file."})])])])])):_("",!0)]),_:1}),o(I,{name:"fade"},{default:b(()=>[this.configurationLoaded?(a(),l("div",Lt,[t("div",Tt,[t("small",Pt,[o(n,{t:"Sort By"})]),t("div",Nt,[(a(!0),l(k,null,C(this.sort,(r,y)=>(a(),l("a",{role:"button",onClick:Ot=>g.updateSort(y),class:d([{"bg-primary-subtle text-primary-emphasis":this.currentSort.key===y},"px-2 py-1 rounded-3"])},[t("small",null,[this.currentSort.key===y?(a(),l("i",{key:0,class:d(["bi me-2",[this.currentSort.order==="asc"?"bi-sort-up":"bi-sort-down"]])},null,2)):_("",!0),p(u(r),1)])],10,It))),256))])]),t("div",Vt,[t("small",Bt,[o(n,{t:"Display as"})]),t("div",Kt,[(a(),l(k,null,C([{name:"List",key:"list"},{name:"Grid",key:"grid"}],r=>t("a",{role:"button",onClick:y=>g.updateDisplay(r.name),class:d([{"bg-primary-subtle text-primary-emphasis":this.currentDisplay===r.name},"px-2 py-1 rounded-3"])},[t("small",null,[t("i",{class:d(["bi me-2","bi-"+r.key])},null,2),e[6]||(e[6]=p()),o(n,{t:r.name},null,8,["t"])])],10,Ut)),64))])]),t("div",Ft,[e[7]||(e[7]=t("label",{for:"configurationSearch",class:"text-muted"},[t("i",{class:"bi bi-search me-2"})],-1)),T(t("input",{class:"form-control form-control-sm rounded-3","onUpdate:modelValue":e[1]||(e[1]=r=>this.searchKey=r),id:"configurationSearch"},null,512),[[K,this.searchKey]])])])):_("",!0)]),_:1}),t("div",Gt,[o(M,{name:"fade"},{default:b(()=>[this.configurationLoaded&&this.wireguardConfigurationsStore.Configurations.length===0?(a(),l("p",$t,[o(n,{t:"You don't have any WireGuard configurations yet. Please check the configuration folder or change it in Settings. By default the folder is /etc/wireguard."})])):this.configurationLoaded?(a(!0),l(k,{key:1},C(g.configurations,(r,y)=>(a(),w(v,{display:this.currentDisplay,delay:y*.03+"s",key:r.Name,c:r},null,8,["display","delay","c"]))),128)):_("",!0)]),_:1})])])])}const Jt=D(gt,[["render",Rt],["__scopeId","data-v-d19eaedb"]]);export{Jt as default};
//# sourceMappingURL=configurationList-MCRjStPn.js.map
