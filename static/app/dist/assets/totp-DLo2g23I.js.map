{"version":3,"file":"totp-DLo2g23I.js","sources":["../../src/components/setupComponent/totp.vue"],"sourcesContent":["<script>\nimport {fetchGet, fetchPost} from \"@/utilities/fetch.js\";\nimport QRCode from \"qrcode\";\nimport {DashboardConfigurationStore} from \"@/stores/DashboardConfigurationStore.js\";\nimport LocaleText from \"@/components/text/localeText.vue\";\n\nexport default {\n\tname: \"totp\",\n\tcomponents: {LocaleText},\n\tasync setup(){\n\t\tconst store = DashboardConfigurationStore();\n\t\tlet l = \"\"\n\t\tawait fetchGet(\"/api/Welcome_GetTotpLink\", {}, (res => {\n\t\t\tif (res.status) l = res.data;\n\t\t}));\n\t\treturn {l, store}\n\t},\n\tmounted() {\n\t\tif (this.l) {\n\t\t\tQRCode.toCanvas(document.getElementById('qrcode'), this.l, function (error) {})\n\t\t}\n\t},\n\tdata(){\n\t\treturn {\n\t\t\ttotp: \"\",\n\t\t\ttotpInvalidMessage: \"\",\n\t\t\tverified: false\n\t\t}\n\t},\n\tmethods: {\n\t\tvalidateTotp(){\n\t\t\t\n\t\t}\t\n\t},\n\twatch: {\n\t\ttotp(newVal){\n\t\t\tconst input = document.querySelector(\"#totp\");\n\t\t\tinput.classList.remove(\"is-invalid\", \"is-valid\")\n\t\t\tif (newVal.length === 6){\n\t\t\t\tconsole.log(newVal)\n\t\t\t\tif (/[0-9]{6}/.test(newVal)){\n\t\t\t\t\tfetchPost(\"/api/Welcome_VerifyTotpLink\", {\n\t\t\t\t\t\ttotp: newVal\n\t\t\t\t\t}, (res) => {\n\t\t\t\t\t\tif (res.status){\n\t\t\t\t\t\t\tthis.verified = true;\n\t\t\t\t\t\t\tinput.classList.add(\"is-valid\");\n\t\t\t\t\t\t\tthis.$emit(\"verified\")\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tinput.classList.add(\"is-invalid\")\n\t\t\t\t\t\t\tthis.totpInvalidMessage = \"TOTP does not match.\"\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}else{\n\t\t\t\t\tinput.classList.add(\"is-invalid\");\n\t\t\t\t\tthis.totpInvalidMessage = \"TOTP can only contain numbers\"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n</script>\n\n<template>\n\t<div class=\"container-fluid login-container-fluid d-flex main pt-5 overflow-scroll\"\n\t     :data-bs-theme=\"this.store.Configuration?.Server?.dashboard_theme\">\n\t\t<div class=\"m-auto text-body\" style=\"width: 500px\">\n\t\t\t<div  class=\"d-flex flex-column\">\n\t\t\t\t<div>\n\t\t\t\t\t<h1 class=\"dashboardLogo display-4\">\n\t\t\t\t\t\t<LocaleText t=\"Multi-Factor Authentication (MFA)\"></LocaleText>\n\t\t\t\t\t</h1>\n\t\t\t\t\t<p class=\"mb-2\"><small class=\"text-muted\">\n\t\t\t\t\t\t<LocaleText t=\"1. Please scan the following QR Code to generate TOTP with your choice of authenticator\"></LocaleText>\n\t\t\t\t\t</small></p>\n\t\t\t\t\t<canvas id=\"qrcode\" class=\"rounded-3 mb-2\"></canvas>\n\t\t\t\t\t<div class=\"p-3 bg-body-secondary rounded-3 border mb-3\">\n\t\t\t\t\t\t<p class=\"text-muted mb-0\">\n\t\t\t\t\t\t\t<small>\n\t\t\t\t\t\t\t\t<LocaleText t=\"Or you can click the link below:\"></LocaleText>\n\t\t\t\t\t\t\t</small>\n\t\t\t\t\t\t</p><a :href=\"this.l\"><code style=\"line-break: anywhere\">{{this.l}}</code></a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<label for=\"totp\" class=\"mb-2\">\n\t\t\t\t\t\t<small class=\"text-muted\">\n\t\t\t\t\t\t\t<LocaleText t=\"2. Enter the TOTP generated by your authenticator to verify\"></LocaleText>\n\t\t\t\t\t\t</small>\n\t\t\t\t\t</label>\n\t\t\t\t\t<div class=\"form-group mb-2\">\n\t\t\t\t\t\t<input class=\"form-control text-center totp\"\n\t\t\t\t\t\t       id=\"totp\" maxlength=\"6\" type=\"text\" inputmode=\"numeric\" autocomplete=\"one-time-code\"\n\t\t\t\t\t\t       v-model=\"this.totp\"\n\t\t\t\t\t\t       :disabled=\"this.verified\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"invalid-feedback\">\n\t\t\t\t\t\t\t<LocaleText :t=\"this.totpInvalidMessage\"></LocaleText>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"valid-feedback\">\n\t\t\t\t\t\t\t<LocaleText t=\"TOTP verified!\"></LocaleText>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<hr>\n\t\t\t\t<div class=\"d-flex gap-3 mt-5 flex-column\">\n\t\t\t\t\t<RouterLink\n\t\t\t\t\t\tto=\"/\"\n\t\t\t\t\t\tv-if=\"!this.verified\"\n\t\t\t\t\t\tclass=\"btn bg-secondary-subtle text-secondary-emphasis \n\t\t\t\t\t\t\trounded-3\n\t\t\t\t\t\t\tflex-grow-1 btn-lg border-1 border-secondary-subtle shadow d-flex\">\n\t\t\t\t\t\t<LocaleText t=\"I don't need MFA\"></LocaleText>\n\t\t\t\t\t\t<i class=\"bi bi-chevron-right ms-auto\"></i>\n\t\t\t\t\t</RouterLink>\n\t\t\t\t\t<RouterLink\n\t\t\t\t\t\tto=\"/\"\n\t\t\t\t\t\tv-else class=\"btn btn-dark btn-lg d-flex btn-brand shadow align-items-center flex-grow-1 rounded-3\">\n\t\t\t\t\t\t<LocaleText t=\"Complete\"></LocaleText>\n\t\t\t\t\t\t<i class=\"bi bi-chevron-right ms-auto\"></i>\n\t\t\t\t\t</RouterLink>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t\n\t\n</template>\n\n<style scoped>\n\t\n</style>"],"names":["_sfc_main","LocaleText","store","DashboardConfigurationStore","l","fetchGet","res","QRCode","error","newVal","input","fetchPost","_hoisted_1","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_createElementBlock","_createElementVNode","_hoisted_2","_createVNode","_component_LocaleText","_toDisplayString","_hoisted_11","_cache","$event","_createBlock","_component_RouterLink","_withCtx"],"mappings":"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"}