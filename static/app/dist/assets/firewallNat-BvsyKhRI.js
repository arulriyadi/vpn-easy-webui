import{_ as F,r as v,q as S,o as j,c as o,b as e,f as r,F as q,m as B,t as d,e as y,h as L,z as p,C as D,L as G,A as b,a as n,n as z}from"./index-BHlSp020.js";const Q={class:"container-fluid"},H={class:"row"},K={class:"col-12"},W={class:"card"},X={class:"card-body"},Y={key:0,class:"text-center py-4"},Z={key:1,class:"text-center py-4 text-muted"},tt={key:2,class:"table-responsive"},et={class:"table table-striped table-hover"},st=["onDragstart","onDrop"],at={class:"badge bg-primary"},lt={class:"badge bg-secondary"},ot={key:0,class:"badge bg-info"},nt={key:1,class:"text-muted"},rt={key:0,class:"badge bg-success"},dt={key:1,class:"badge bg-danger"},it={key:2,class:"badge bg-warning"},ut={key:3,class:"badge bg-primary"},ct={key:4,class:"badge bg-info"},pt={key:5,class:"badge bg-secondary"},vt=["onClick","disabled"],mt={class:"card-footer bg-light border-top"},bt={class:"d-flex justify-content-between align-items-center"},gt={class:"d-flex align-items-center"},ft={class:"text-muted"},yt={key:0,class:"text-warning ms-2"},Tt={class:"d-flex gap-2"},Nt=["disabled"],At=["disabled"],ht={key:0,class:"spinner-border spinner-border-sm me-1",role:"status"},Rt={key:1,class:"bi bi-check-lg me-1"},wt=["disabled"],Dt={class:"modal fade",id:"addNatRuleModal",tabindex:"-1","aria-hidden":"true"},xt={class:"modal-dialog modal-lg"},Pt={class:"modal-content"},Ct={class:"modal-body"},It={class:"row"},St={class:"col-md-6 mb-3"},Et={class:"col-md-6 mb-3"},kt={class:"row"},_t={class:"col-md-6 mb-3"},Ut={class:"col-md-6 mb-3"},Ot={class:"row"},Mt={class:"col-md-6 mb-3"},Vt={class:"col-md-6 mb-3"},$t={key:0,class:"row"},Jt={class:"col-md-6 mb-3"},Ft={class:"col-md-6 mb-3"},jt={key:1,class:"row"},qt={class:"col-md-12 mb-3"},Bt={key:2,class:"row"},Lt={class:"col-md-12 mb-3"},Gt={class:"mt-4"},zt={class:"bg-dark text-light p-3 rounded"},Qt={class:"modal-footer"},Ht=["disabled"],Kt={key:0,class:"spinner-border spinner-border-sm me-1",role:"status"},Wt={__name:"firewallNat",setup(Xt){const u=v([]),N=v([]),i=v(!1),A=v(!1),T=v(!1),g=v(-1),R=v(-1),l=v({chain:"",target:"",source:"",destination:"",protocol:"any",port:"",translatedIp:"",translatedPort:""}),x=S(()=>{const s=l.value;return!(!s.chain||!s.target||s.target==="DNAT"&&!s.translatedIp||s.target==="SNAT"&&!s.translatedIp||s.target==="REDIRECT"&&!s.translatedPort)}),E=S(()=>{const s=l.value;if(!s.chain||!s.target)return"Select chain and target to see command";let t=`iptables -t nat -A ${s.chain}`;return s.source&&(t+=` -s ${s.source}`),s.destination&&(t+=` -d ${s.destination}`),s.protocol!=="any"&&(t+=` -p ${s.protocol}`),s.port&&(t+=` --dport ${s.port}`),t+=` -j ${s.target}`,s.target==="DNAT"?(t+=` --to-destination ${s.translatedIp}`,s.translatedPort&&(t+=`:${s.translatedPort}`)):s.target==="SNAT"?t+=` --to-source ${s.translatedIp}`:s.target==="REDIRECT"&&(t+=` --to-ports ${s.translatedPort}`),t}),h=async()=>{i.value=!0;try{const t=await(await fetch("/api/firewall/nat")).json();t.status?(u.value=t.data||[],N.value=JSON.parse(JSON.stringify(u.value)),T.value=!1):console.error("Failed to load NAT rules:",t.message)}catch(s){console.error("Error loading NAT rules:",s)}finally{i.value=!1}},P=async()=>{if(!x.value){c("error","Please fill in all required fields");return}i.value=!0;try{const t=await(await fetch("/api/firewall/nat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l.value)})).json();t.status?(w(),I(),await h(),c("success","NAT rule added successfully")):c("error",t.message||"Failed to add NAT rule")}catch(s){console.error("Error adding NAT rule:",s),c("error","Error adding NAT rule: "+s.message)}finally{i.value=!1}},k=async s=>{if(confirm("Are you sure you want to delete this NAT rule?")){i.value=!0;try{const a=await(await fetch(`/api/firewall/nat/${s}`,{method:"DELETE"})).json();a.status?(await h(),c("success","NAT rule deleted successfully")):c("error",a.message||"Failed to delete NAT rule")}catch(t){console.error("Error deleting NAT rule:",t),c("error","Error deleting NAT rule: "+t.message)}finally{i.value=!1}}},_=async()=>{await h(),c("info","NAT rules reloaded")},C=()=>{l.value.translatedIp="",l.value.translatedPort=""},I=()=>{l.value={chain:"",target:"",source:"",destination:"",protocol:"any",port:"",translatedIp:"",translatedPort:""}},U=()=>{I(),new bootstrap.Modal(document.getElementById("addNatRuleModal")).show()},w=()=>{const s=bootstrap.Modal.getInstance(document.getElementById("addNatRuleModal"));s&&s.hide()},O=(s,t)=>{g.value=s,t.dataTransfer.effectAllowed="move",t.target.style.opacity="0.5"},M=s=>{s.preventDefault(),s.dataTransfer.dropEffect="move"},V=(s,t)=>{if(s.preventDefault(),R.value=t,g.value!==t){const a=u.value[g.value];u.value.splice(g.value,1),u.value.splice(t,0,a),T.value=!0}},$=s=>{s.target.style.opacity="",g.value=-1,R.value=-1},J=async()=>{try{A.value=!0;const s=u.value.map((a,m)=>({id:a.id,position:m+1})),t=await fetch("/api/firewall/nat/reorder",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({rules:s})}).then(a=>a.json());t.status?(c("success","NAT rules reordered successfully"),N.value=JSON.parse(JSON.stringify(u.value)),T.value=!1):(c("error",t.message||"Failed to save NAT rule order"),u.value=JSON.parse(JSON.stringify(N.value)))}catch(s){c("error","Error saving NAT rule order: "+s.message),u.value=JSON.parse(JSON.stringify(N.value))}finally{A.value=!1}},c=(s,t)=>{const a=document.createElement("div");a.className=`alert alert-${s==="error"?"danger":s} alert-dismissible fade show position-fixed`,a.style.top="20px",a.style.right="20px",a.style.zIndex="9999",a.innerHTML=`
    ${t}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  `,document.body.appendChild(a),setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},5e3)};return j(()=>{h()}),(s,t)=>(n(),o("div",Q,[e("div",H,[e("div",K,[t[22]||(t[22]=e("div",{class:"mb-4"},[e("h2",{class:"mb-0"},[e("i",{class:"bi bi-arrow-left-right me-2"}),r(" Firewall NAT ")])],-1)),e("div",W,[t[21]||(t[21]=e("div",{class:"card-header"},[e("h5",{class:"mb-0"},[e("i",{class:"bi bi-list-ul me-2"}),r(" Current NAT Rules ")])],-1)),e("div",X,[i.value?(n(),o("div",Y,t[11]||(t[11]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)]))):u.value.length===0?(n(),o("div",Z,t[12]||(t[12]=[e("i",{class:"bi bi-arrow-left-right fs-1"},null,-1),e("p",{class:"mt-2"},"No NAT rules found",-1)]))):(n(),o("div",tt,[e("table",et,[t[15]||(t[15]=e("thead",{class:"table-dark"},[e("tr",null,[e("th",{width:"40"},[e("i",{class:"bi bi-grip-vertical text-muted"})]),e("th",null,"ID"),e("th",null,"Chain"),e("th",null,"Source"),e("th",null,"Destination"),e("th",null,"Protocol"),e("th",null,"Port"),e("th",null,"Target"),e("th",null,"Actions")])],-1)),e("tbody",null,[(n(!0),o(q,null,B(u.value,(a,m)=>(n(),o("tr",{key:a.id,draggable:!0,onDragstart:f=>O(m,f),onDragover:t[0]||(t[0]=f=>M(f)),onDrop:f=>V(m,f),onDragend:$,class:z([{"drag-over":g.value===m&&R.value===m},"draggable-row"])},[t[14]||(t[14]=e("td",{class:"drag-handle"},[e("i",{class:"bi bi-grip-vertical text-muted cursor-grab"})],-1)),e("td",null,[e("span",at,d(m+1),1)]),e("td",null,[e("span",lt,d(a.chain),1)]),e("td",null,[e("code",null,d(a.source||"Any"),1)]),e("td",null,[e("code",null,d(a.destination||"Any"),1)]),e("td",null,[a.protocol&&a.protocol!=="any"?(n(),o("span",ot,d(a.protocol),1)):(n(),o("span",nt,"Any"))]),e("td",null,[e("code",null,d(a.port||"Any"),1)]),e("td",null,[a.target==="ACCEPT"?(n(),o("span",rt,d(a.target),1)):a.target==="DROP"?(n(),o("span",dt,d(a.target),1)):a.target==="MASQUERADE"?(n(),o("span",it,d(a.target),1)):a.target==="SNAT"?(n(),o("span",ut,d(a.target),1)):a.target==="DNAT"?(n(),o("span",ct,d(a.target),1)):(n(),o("span",pt,d(a.target),1))]),e("td",null,[e("button",{class:"btn btn-outline-danger btn-sm",onClick:f=>k(a.id),disabled:i.value,title:"Delete Rule"},t[13]||(t[13]=[e("i",{class:"bi bi-trash"},null,-1)]),8,vt)])],42,st))),128))])])]))]),e("div",mt,[e("div",bt,[e("div",gt,[t[17]||(t[17]=e("i",{class:"bi bi-info-circle me-2 text-muted"},null,-1)),e("span",ft,[r(" Total NAT Rules: "+d(u.value.length)+" ",1),T.value?(n(),o("span",yt,t[16]||(t[16]=[e("i",{class:"bi bi-exclamation-triangle"},null,-1),r(" Unsaved changes ")]))):y("",!0)])]),e("div",Tt,[e("button",{class:"btn btn-primary",onClick:U,disabled:i.value},t[18]||(t[18]=[e("i",{class:"bi bi-plus-circle me-1"},null,-1),r(" Add NAT Rule ")]),8,Nt),T.value?(n(),o("button",{key:0,class:"btn btn-success",onClick:J,disabled:A.value||i.value},[A.value?(n(),o("span",ht)):(n(),o("i",Rt)),t[19]||(t[19]=r(" Save Changes "))],8,At)):y("",!0),e("button",{class:"btn btn-outline-secondary",onClick:_,disabled:i.value},t[20]||(t[20]=[e("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),r(" Reload NAT Rules ")]),8,wt)])])])])])]),e("div",Dt,[e("div",xt,[e("div",Pt,[e("div",{class:"modal-header"},[t[23]||(t[23]=e("h5",{class:"modal-title"},[e("i",{class:"bi bi-plus-circle me-2"}),r(" Add NAT Rule ")],-1)),e("button",{type:"button",class:"btn-close",onClick:w})]),e("div",Ct,[e("form",{onSubmit:L(P,["prevent"])},[e("div",It,[e("div",St,[t[25]||(t[25]=e("label",{class:"form-label"},[r("Chain "),e("span",{class:"text-danger"},"*")],-1)),p(e("select",{class:"form-select","onUpdate:modelValue":t[1]||(t[1]=a=>l.value.chain=a),required:"",onChange:C},t[24]||(t[24]=[e("option",{value:""},"Select Chain",-1),e("option",{value:"PREROUTING"},"PREROUTING",-1),e("option",{value:"POSTROUTING"},"POSTROUTING",-1),e("option",{value:"OUTPUT"},"OUTPUT",-1)]),544),[[D,l.value.chain]]),t[26]||(t[26]=e("div",{class:"form-text"},"NAT chain for the rule",-1))]),e("div",Et,[t[28]||(t[28]=e("label",{class:"form-label"},[r("Target "),e("span",{class:"text-danger"},"*")],-1)),p(e("select",{class:"form-select","onUpdate:modelValue":t[2]||(t[2]=a=>l.value.target=a),required:"",onChange:C},t[27]||(t[27]=[G('<option value="" data-v-93486327>Select Target</option><option value="DNAT" data-v-93486327>DNAT (Destination NAT)</option><option value="SNAT" data-v-93486327>SNAT (Source NAT)</option><option value="MASQUERADE" data-v-93486327>MASQUERADE</option><option value="REDIRECT" data-v-93486327>REDIRECT</option>',5)]),544),[[D,l.value.target]]),t[29]||(t[29]=e("div",{class:"form-text"},"NAT target type",-1))])]),e("div",kt,[e("div",_t,[t[30]||(t[30]=e("label",{class:"form-label"},"Source IP",-1)),p(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=a=>l.value.source=a),placeholder:"192.168.1.0/24 (optional)"},null,512),[[b,l.value.source]]),t[31]||(t[31]=e("div",{class:"form-text"},"Source IP address or subnet (optional)",-1))]),e("div",Ut,[t[32]||(t[32]=e("label",{class:"form-label"},"Destination IP",-1)),p(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[4]||(t[4]=a=>l.value.destination=a),placeholder:"0.0.0.0/0 (optional)"},null,512),[[b,l.value.destination]]),t[33]||(t[33]=e("div",{class:"form-text"},"Destination IP address or subnet (optional)",-1))])]),e("div",Ot,[e("div",Mt,[t[35]||(t[35]=e("label",{class:"form-label"},"Protocol",-1)),p(e("select",{class:"form-select","onUpdate:modelValue":t[5]||(t[5]=a=>l.value.protocol=a)},t[34]||(t[34]=[e("option",{value:"any"},"Any",-1),e("option",{value:"tcp"},"TCP",-1),e("option",{value:"udp"},"UDP",-1),e("option",{value:"icmp"},"ICMP",-1)]),512),[[D,l.value.protocol]]),t[36]||(t[36]=e("div",{class:"form-text"},"Protocol for the rule",-1))]),e("div",Vt,[t[37]||(t[37]=e("label",{class:"form-label"},"Port",-1)),p(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[6]||(t[6]=a=>l.value.port=a),placeholder:"80 (optional)"},null,512),[[b,l.value.port]]),t[38]||(t[38]=e("div",{class:"form-text"},"Port number (optional)",-1))])]),l.value.target==="DNAT"?(n(),o("div",$t,[e("div",Jt,[t[39]||(t[39]=e("label",{class:"form-label"},[r("Translated IP "),e("span",{class:"text-danger"},"*")],-1)),p(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[7]||(t[7]=a=>l.value.translatedIp=a),placeholder:"192.168.1.100",required:""},null,512),[[b,l.value.translatedIp]]),t[40]||(t[40]=e("div",{class:"form-text"},"Destination IP for DNAT",-1))]),e("div",Ft,[t[41]||(t[41]=e("label",{class:"form-label"},"Translated Port",-1)),p(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[8]||(t[8]=a=>l.value.translatedPort=a),placeholder:"80"},null,512),[[b,l.value.translatedPort]]),t[42]||(t[42]=e("div",{class:"form-text"},"Destination port for DNAT (optional)",-1))])])):y("",!0),l.value.target==="SNAT"?(n(),o("div",jt,[e("div",qt,[t[43]||(t[43]=e("label",{class:"form-label"},[r("Translated IP "),e("span",{class:"text-danger"},"*")],-1)),p(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[9]||(t[9]=a=>l.value.translatedIp=a),placeholder:"203.0.113.5",required:""},null,512),[[b,l.value.translatedIp]]),t[44]||(t[44]=e("div",{class:"form-text"},"Source IP for SNAT",-1))])])):y("",!0),l.value.target==="REDIRECT"?(n(),o("div",Bt,[e("div",Lt,[t[45]||(t[45]=e("label",{class:"form-label"},[r("Translated Port "),e("span",{class:"text-danger"},"*")],-1)),p(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[10]||(t[10]=a=>l.value.translatedPort=a),placeholder:"80",required:""},null,512),[[b,l.value.translatedPort]]),t[46]||(t[46]=e("div",{class:"form-text"},"Destination port for REDIRECT",-1))])])):y("",!0),e("div",Gt,[t[47]||(t[47]=e("label",{class:"form-label"},"Command Preview:",-1)),e("div",zt,[e("code",null,d(E.value),1)])])],32)]),e("div",Qt,[e("button",{type:"button",class:"btn btn-secondary",onClick:w},"Cancel"),e("button",{type:"button",class:"btn btn-primary",onClick:P,disabled:i.value||!x.value},[i.value?(n(),o("span",Kt)):y("",!0),t[48]||(t[48]=r(" Add NAT Rule "))],8,Ht)])])])])]))}},Zt=F(Wt,[["__scopeId","data-v-93486327"]]);export{Zt as default};
//# sourceMappingURL=firewallNat-BvsyKhRI.js.map
