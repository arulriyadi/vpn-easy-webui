import{_ as P,g as h,M as x,y as w,K as k,c as o,b as s,f as u,t as n,z as v,A as f,F as p,m as g,h as U,C as I,e as _,B as A,n as c,a as i,s as y}from"./index-BHlSp020.js";const G={name:"UserManagement",data(){return{users:[],statistics:{},loading:!1,saving:!1,loadingPermissions:!1,searchQuery:"",showCreateModal:!1,showEditModal:!1,showPermissionsModal:!1,showUserDetailsModal:!1,editingUser:null,selectedUser:null,availableGroups:[],userPermissions:[],activeTab:"userInfo",userGroups:[],vpnPeers:[],loadingUserGroups:!1,loadingVpnPeers:!1,userForm:{username:"",full_name:"",email:"",password:"",user_groups:[],selectedGroupId:"",manual_ip:"",is_active:!0},availableIps:{},ipSearchString:"",selectedSubnet:"",alert:{show:!1,type:"alert-success",message:""},availablePermissions:["dashboard_access","user_management","firewall_management","routing_management","logging_management","system_status","wireguard_management","settings_management"]}},computed:{filteredUsers(){if(!this.searchQuery)return this.users;const l=this.searchQuery.toLowerCase();return this.users.filter(e=>e.username.toLowerCase().includes(l)||e.full_name&&e.full_name.toLowerCase().includes(l)||e.email&&e.email.toLowerCase().includes(l))}},mounted(){this.loadUsers(),this.loadStatistics()},methods:{async loadUsers(){this.loading=!0;try{const l=await h("/api/users");if(l.status){this.users=l.data;for(let e of this.users)try{const d=await h(`/api/users/${e.id}/groups`);d.status?e.user_groups=d.data||[]:e.user_groups=[]}catch(d){console.error(`Error loading groups for user ${e.id}:`,d),e.user_groups=[]}}else this.showAlert("error",l.message)}catch(l){this.showAlert("error","Failed to load users"),console.error("Error loading users:",l)}finally{this.loading=!1}},async loadStatistics(){try{const l=await h("/api/users/statistics");l.status&&(this.statistics=l.data)}catch(l){console.error("Error loading statistics:",l)}},async openAddUserModal(){this.userForm={username:"",full_name:"",email:"",password:"",user_groups:[],selectedGroupId:"",is_active:!0};try{const l=await h("/api/enhanced-rbac/groups");l.status&&(this.availableGroups=l.data||[])}catch(l){console.error("Error loading groups:",l)}await this.loadAvailableIps(),this.showCreateModal=!0},async editUser(l){this.editingUser=l,this.userForm={username:l.username,full_name:l.full_name||"",email:l.email||"",password:"",user_groups:l.user_groups||[],selectedGroupId:"",is_active:l.is_active};try{const e=await h("/api/enhanced-rbac/groups");e.status&&(this.availableGroups=e.data||[])}catch(e){console.error("Error loading groups:",e)}await this.loadAvailableIps(),this.showEditModal=!0},async viewPermissions(l){this.selectedUser=l,this.loadingPermissions=!0,this.showPermissionsModal=!0;try{const e=await h(`/api/users/${l.id}/permissions`);e.status?this.userPermissions=e.data:this.showAlert("error",e.message)}catch(e){this.showAlert("error","Failed to load permissions"),console.error("Error loading permissions:",e)}finally{this.loadingPermissions=!1}},async saveUser(){this.saving=!0;try{let l;if(this.editingUser)l=await x(`/api/users/${this.editingUser.id}`,this.userForm);else{const e={...this.userForm},d=e.user_groups||[];if(delete e.user_groups,delete e.selectedGroupId,l=await w("/api/users",e),l.status&&d.length>0){const b=l.data?.id;if(b){for(const r of d)try{await w(`/api/users/${b}/groups`,{group_id:r.group_id,manual_ip:this.userForm.manual_ip||null})}catch(a){console.error(`Error assigning group ${r.group_name}:`,a)}this.showAlert("success",`${l.message} Groups assigned successfully!`)}}}l.status?(this.editingUser&&this.showAlert("success",l.message),this.closeModal(),this.loadUsers(),this.loadStatistics()):this.showAlert("error",l.message)}catch(l){this.showAlert("error","Failed to save user"),console.error("Error saving user:",l)}finally{this.saving=!1}},async deleteUser(l){if(confirm(`Are you sure you want to delete user "${l.username}"?`))try{const e=await k(`/api/users/${l.id}`);e.status?(this.showAlert("success",e.message),this.loadUsers(),this.loadStatistics()):this.showAlert("error",e.message)}catch(e){this.showAlert("error","Failed to delete user"),console.error("Error deleting user:",e)}},async grantPermission(l){try{const e=await w(`/api/users/${this.selectedUser.id}/permissions`,{permission:l});e.status?(this.userPermissions.push(l),this.showAlert("success","Permission granted successfully")):this.showAlert("error",e.message)}catch(e){this.showAlert("error","Failed to grant permission"),console.error("Error granting permission:",e)}},async revokePermission(l){try{const e=await k(`/api/users/${this.selectedUser.id}/permissions/${l}`);e.status?(this.userPermissions=this.userPermissions.filter(d=>d!==l),this.showAlert("success","Permission revoked successfully")):this.showAlert("error",e.message)}catch(e){this.showAlert("error","Failed to revoke permission"),console.error("Error revoking permission:",e)}},closeModal(){this.showCreateModal=!1,this.showEditModal=!1,this.editingUser=null,this.userForm={username:"",full_name:"",email:"",password:"",user_groups:[],selectedGroupId:"",manual_ip:"",is_active:!0}},generateSuggestedIp(){const l="10.110.56.",e=Math.floor(Math.random()*250)+5;this.userForm.manual_ip=`${l}${e}`,this.showAlert("info",`Suggested IP: ${this.userForm.manual_ip}`)},async loadAvailableIps(){try{console.log("Loading available IPs...");const l=await h("/api/getAvailableIPs/wg0");console.log("Available IPs result:",l),l.status?(this.availableIps=l.data||{},console.log("Available IPs loaded:",this.availableIps),Object.keys(this.availableIps).length>0&&(this.selectedSubnet=Object.keys(this.availableIps)[0],console.log("Default subnet selected:",this.selectedSubnet))):(console.warn("Failed to load available IPs:",l.message),this.availableIps={})}catch(l){console.error("Error loading available IPs:",l),this.availableIps={}}},selectAvailableIp(l){this.userForm.manual_ip=l,this.showAlert("info",`Selected IP: ${l}`)},filteredAvailableIps(){if(!this.availableIps||!this.selectedSubnet||!this.availableIps[this.selectedSubnet])return[];let l=this.availableIps[this.selectedSubnet];return this.ipSearchString&&(l=l.filter(e=>e.includes(this.ipSearchString))),l},async viewUserDetails(l){this.selectedUser=l,this.activeTab="userInfo",this.showUserDetailsModal=!0,await this.loadUserGroups(),await this.loadVpnPeers()},async loadUserGroups(){if(this.selectedUser){this.loadingUserGroups=!0;try{const l=await h(`/api/users/${this.selectedUser.id}/groups`);l.status?this.userGroups=l.data:this.showAlert("error",l.message)}catch(l){this.showAlert("error","Failed to load user groups"),console.error("Error loading user groups:",l)}finally{this.loadingUserGroups=!1}}},async loadVpnPeers(){if(this.selectedUser){this.loadingVpnPeers=!0;try{const l=await h(`/api/users/${this.selectedUser.id}/vpn-peers`);l.status?this.vpnPeers=l.data:this.showAlert("error",l.message)}catch(l){this.showAlert("error","Failed to load VPN peers"),console.error("Error loading VPN peers:",l)}finally{this.loadingVpnPeers=!1}}},async assignUserToGroup(){this.showAlert("info","Group assignment feature coming soon")},async downloadVpnConfig(l){try{const e=await h(`/api/users/${this.selectedUser.id}/vpn-config`);if(e.status){const d=this.generateWireguardConfig(l,e.data);this.downloadFile(d,`${this.selectedUser.username}-${l.group_name}.conf`),this.showAlert("success","VPN config downloaded successfully")}else this.showAlert("error",e.message)}catch(e){this.showAlert("error","Failed to download VPN config"),console.error("Error downloading VPN config:",e)}},generateWireguardConfig(l,e){return`[Interface]
PrivateKey = ${l.private_key}
Address = ${l.peer_ip}/32
DNS = 8.8.8.8

[Peer]
PublicKey = SERVER_PUBLIC_KEY
Endpoint = SERVER_ENDPOINT:51820
AllowedIPs = ${e.peers.find(d=>d.id===l.id)?.allowed_ips?.join(",")||"0.0.0.0/0"}
PersistentKeepalive = 25`},downloadFile(l,e){const d=new Blob([l],{type:"text/plain"}),b=window.URL.createObjectURL(d),r=document.createElement("a");r.href=b,r.download=e,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(b),document.body.removeChild(r)},getGroupStatusBadge(l){return l.vpn_peer_generated?"bg-success":l.vpn_enabled?"bg-info":"bg-warning"},async handleGroupSelection(){this.userForm.selectedGroupId&&(this.editingUser||this.showCreateModal)&&(console.log("Group selected:",this.userForm.selectedGroupId),await this.confirmGroupAssignment(),this.userForm.selectedGroupId="")},isUserInGroup(l){return this.userForm.user_groups?this.userForm.user_groups.some(e=>e.group_id===l):!1},async confirmGroupAssignment(){const l=this.userForm.selectedGroupId;if(!l)return;if(this.showCreateModal){this.userForm.user_groups||(this.userForm.user_groups=[]);const d=this.availableGroups.find(b=>b.id===parseInt(l));d&&(this.userForm.user_groups.push({group_id:d.id,group_name:d.name,group_color:d.color}),this.showAlert("success",`Group "${d.name}" will be assigned after user creation.`)),this.userForm.selectedGroupId="";return}const e=this.editingUser?.id;if(e)try{const d=await w(`/api/users/${e}/groups`,{group_id:parseInt(l),manual_ip:this.userForm.manual_ip||null});d.status?(this.showAlert("success","User successfully assigned to group! VPN peer generated."),await this.loadUsers(),this.userForm.selectedGroupId=""):this.showAlert("error",d.message||"Failed to assign user to group")}catch(d){console.error("Error assigning user to group:",d),this.showAlert("error","Failed to assign user to group")}},async removeUserFromGroup(l){if(this.showCreateModal){this.userForm.user_groups&&(this.userForm.user_groups=this.userForm.user_groups.filter(d=>d.group_id!==l),this.showAlert("success","Group removed from assignment list."));return}const e=this.editingUser?.id;if(e)try{const d=await k(`/api/users/${e}/groups/${l}`);d.status?(this.showAlert("success","User successfully removed from group!"),await this.loadUsers(),this.showEditModal&&this.userForm.user_groups&&(this.userForm.user_groups=this.userForm.user_groups.filter(b=>b.group_id!==l))):this.showAlert("error",d.message||"Failed to remove user from group")}catch(d){console.error("Error removing user from group:",d),this.showAlert("error","Failed to remove user from group")}},formatDate(l){return l?new Date(l).toLocaleString():"Never"},formatPermission(l){return l.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())},showAlert(l,e){this.alert={show:!0,type:`alert-${l==="error"?"danger":l}`,message:e},setTimeout(()=>{this.alert.show=!1},5e3)}}},F={class:"user-management"},C={class:"d-flex justify-content-between align-items-center mb-4"},S=["disabled"],M={class:"row mb-4"},N={class:"col-md-3"},V={class:"card bg-primary text-white"},E={class:"card-body"},D={class:"d-flex justify-content-between"},L={class:"mb-0"},T={class:"col-md-3"},j={class:"card bg-success text-white"},R={class:"card-body"},B={class:"d-flex justify-content-between"},O={class:"mb-0"},Q={class:"col-md-3"},z={class:"card bg-warning text-white"},K={class:"card-body"},q={class:"d-flex justify-content-between"},W={class:"mb-0"},H={class:"col-md-3"},Y={class:"card bg-info text-white"},J={class:"card-body"},X={class:"d-flex justify-content-between"},Z={class:"mb-0"},$={class:"card"},ss={class:"card-header"},es={class:"d-flex justify-content-between align-items-center"},ts={class:"d-flex gap-2"},ls=["disabled"],rs={class:"card-body p-0"},os={key:0,class:"text-center p-4"},is={key:1,class:"text-center p-4"},ns={key:2,class:"table-responsive"},as={class:"table table-hover table-dark mb-0"},ds={class:"d-flex align-items-center"},us={key:0},cs={key:1,class:"text-muted"},ms={key:0},ps={key:1},gs={key:1},bs={class:"text-muted"},hs={class:"btn-group btn-group-sm"},vs=["onClick"],_s=["onClick"],fs=["onClick"],ys=["onClick","disabled"],ws={key:0,class:"modal fade show",style:{display:"block","background-color":"rgba(0,0,0,0.5)"},tabindex:"-1"},Us={class:"modal-dialog"},ks={class:"modal-content"},Ps={class:"modal-header"},xs={class:"modal-title"},Is={class:"modal-body"},As={class:"mb-3"},Gs=["disabled"],Fs={class:"mb-3"},Cs={class:"mb-3"},Ss={class:"mb-3"},Ms=["value","disabled"],Ns={key:0,class:"mt-2"},Vs={class:"d-flex flex-wrap gap-2 mt-1"},Es=["onClick"],Ds={key:1,class:"text-muted mt-1"},Ls={class:"mb-3"},Ts={class:"input-group"},js={class:"dropdown"},Rs=["disabled"],Bs={class:"dropdown-menu",style:{width:"300px"}},Os={key:0},Qs={class:"px-3 d-flex gap-3 align-items-center"},zs={class:"px-3 overflow-x-scroll d-flex gap-2"},Ks=["onClick"],qs={class:"overflow-y-scroll",style:{height:"200px"}},Ws=["onClick"],Hs={key:0,class:"px-3 py-2"},Ys={class:"text-muted"},Js={class:"mb-3"},Xs={class:"form-label"},Zs=["required"],$s={key:0,class:"mb-3"},se={class:"form-check"},ee={class:"modal-footer"},te=["disabled"],le={key:0,class:"spinner-border spinner-border-sm me-2"},re={key:1,class:"modal fade show",style:{display:"block","background-color":"rgba(0,0,0,0.5)"},tabindex:"-1"},oe={class:"modal-dialog modal-lg"},ie={class:"modal-content"},ne={class:"modal-header"},ae={class:"modal-title"},de={class:"modal-body"},ue={key:0,class:"text-center p-4"},ce={key:1},me={class:"row"},pe={class:"col-md-6"},ge={class:"list-group"},be=["onClick"],he={class:"col-md-6"},ve={class:"list-group"},_e=["onClick"],fe={class:"modal-footer"},ye={key:2,class:"modal fade show",style:{display:"block","background-color":"rgba(0,0,0,0.5)"},tabindex:"-1"},we={class:"modal-dialog modal-xl"},Ue={class:"modal-content"},ke={class:"modal-header"},Pe={class:"modal-title"},xe={class:"modal-body"},Ie={class:"nav nav-tabs",id:"userDetailsTabs"},Ae={class:"nav-item"},Ge={class:"nav-item"},Fe={class:"nav-item"},Ce={class:"tab-content"},Se={class:"row mt-3"},Me={class:"col-md-6"},Ne={class:"table table-borderless"},Ve={key:0},Ee={key:1,class:"text-muted"},De={class:"col-md-6"},Le={class:"table table-borderless"},Te={class:"row mt-3"},je={class:"col-md-8"},Re={key:0,class:"text-center p-3"},Be={key:1,class:"text-center p-4 text-muted"},Oe={key:2},Qe={class:"card-body"},ze={class:"d-flex justify-content-between align-items-center"},Ke={class:"d-flex align-items-center"},qe={class:"text-muted"},We={class:"text-end"},He={class:"text-muted"},Ye={class:"col-md-4"},Je={class:"d-grid gap-2"},Xe={class:"row mt-3"},Ze={class:"col-md-8"},$e={key:0,class:"text-center p-3"},st={key:1,class:"text-center p-4 text-muted"},et={key:2},tt={class:"card-body"},lt={class:"d-flex justify-content-between align-items-center"},rt={class:"d-flex align-items-center"},ot={class:"text-muted"},it={class:"text-end"},nt=["onClick"],at={class:"col-md-4"},dt={class:"card"},ut={class:"card-body"},ct={class:"row text-center"},mt={class:"col-4"},pt={class:"text-primary"},gt={class:"col-4"},bt={class:"text-success"},ht={class:"col-4"},vt={class:"text-warning"},_t={class:"modal-footer"};function ft(l,e,d,b,r,a){return i(),o("div",F,[s("div",C,[e[28]||(e[28]=s("div",null,[s("h2",{class:"mb-1"},"User Management"),s("p",{class:"text-muted mb-0"},"Manage system users and permissions")],-1)),s("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=(...t)=>a.openAddUserModal&&a.openAddUserModal(...t)),disabled:r.loading},e[27]||(e[27]=[s("i",{class:"bi bi-person-plus me-2"},null,-1),u("Add User ")]),8,S)]),s("div",M,[s("div",N,[s("div",V,[s("div",E,[s("div",D,[s("div",null,[s("h4",L,n(r.statistics.total_users||0),1),e[29]||(e[29]=s("p",{class:"mb-0"},"Total Users",-1))]),e[30]||(e[30]=s("div",{class:"align-self-center"},[s("i",{class:"bi bi-people fs-1"})],-1))])])])]),s("div",T,[s("div",j,[s("div",R,[s("div",B,[s("div",null,[s("h4",O,n(r.statistics.active_users||0),1),e[31]||(e[31]=s("p",{class:"mb-0"},"Active Users",-1))]),e[32]||(e[32]=s("div",{class:"align-self-center"},[s("i",{class:"bi bi-person-check fs-1"})],-1))])])])]),s("div",Q,[s("div",z,[s("div",K,[s("div",q,[s("div",null,[s("h4",W,n(r.statistics.admin_users||0),1),e[33]||(e[33]=s("p",{class:"mb-0"},"Admin Users",-1))]),e[34]||(e[34]=s("div",{class:"align-self-center"},[s("i",{class:"bi bi-shield-check fs-1"})],-1))])])])]),s("div",H,[s("div",Y,[s("div",J,[s("div",X,[s("div",null,[s("h4",Z,n(r.statistics.active_sessions||0),1),e[35]||(e[35]=s("p",{class:"mb-0"},"Active Sessions",-1))]),e[36]||(e[36]=s("div",{class:"align-self-center"},[s("i",{class:"bi bi-laptop fs-1"})],-1))])])])])]),s("div",$,[s("div",ss,[s("div",es,[e[38]||(e[38]=s("h5",{class:"mb-0"},"Users",-1)),s("div",ts,[v(s("input",{type:"text",class:"form-control form-control-sm",placeholder:"Search users...","onUpdate:modelValue":e[1]||(e[1]=t=>r.searchQuery=t),style:{width:"200px"}},null,512),[[f,r.searchQuery]]),s("button",{class:"btn btn-outline-secondary btn-sm",onClick:e[2]||(e[2]=(...t)=>a.loadUsers&&a.loadUsers(...t)),disabled:r.loading},e[37]||(e[37]=[s("i",{class:"bi bi-arrow-clockwise"},null,-1)]),8,ls)])])]),s("div",rs,[r.loading?(i(),o("div",os,e[39]||(e[39]=[s("div",{class:"spinner-border",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1)]))):a.filteredUsers.length===0?(i(),o("div",is,e[40]||(e[40]=[s("i",{class:"bi bi-people fs-1 text-muted"},null,-1),s("p",{class:"text-muted mt-2"},"No users found",-1)]))):(i(),o("div",ns,[s("table",as,[e[47]||(e[47]=s("thead",null,[s("tr",null,[s("th",null,"Username"),s("th",null,"Full Name"),s("th",null,"Email"),s("th",null,"Groups"),s("th",null,"VPN IP"),s("th",null,"VPN Status"),s("th",null,"Status"),s("th",null,"Last Login"),s("th",null,"Actions")])],-1)),s("tbody",null,[(i(!0),o(p,null,g(a.filteredUsers,t=>(i(),o("tr",{key:t.id},[s("td",null,[s("div",ds,[e[41]||(e[41]=s("i",{class:"bi bi-person-circle me-2"},null,-1)),s("strong",null,n(t.username),1)])]),s("td",null,n(t.full_name||"-"),1),s("td",null,n(t.email||"-"),1),s("td",null,[t.user_groups&&t.user_groups.length>0?(i(),o("div",us,[(i(!0),o(p,null,g(t.user_groups,m=>(i(),o("span",{key:m.group_id,class:"badge me-1 mb-1",style:y(`background-color: ${m.group_color||"#6c757d"}; color: white;`)},n(m.group_name),5))),128))])):(i(),o("span",cs,e[42]||(e[42]=[s("i",{class:"bi bi-exclamation-circle"},null,-1),u(" No Groups ")])))]),s("td",null,[t.user_groups&&t.user_groups.length>0&&t.user_groups[0].vpn_peer_generated?(i(),o("span",ms,n(t.user_groups[0].peer_ip),1)):(i(),o("span",ps,"No VPN"))]),s("td",null,[t.user_groups&&t.user_groups.length>0&&t.user_groups[0].vpn_peer_generated?(i(),o("span",{key:0,class:c(["badge",t.user_groups[0].peer_status==="active"?"bg-success":t.user_groups[0].peer_status==="pending"?"bg-warning":"bg-secondary"])},n(t.user_groups[0].peer_status),3)):(i(),o("span",gs,"No VPN"))]),s("td",null,[s("span",{class:c(["badge",t.is_active?"bg-success":"bg-secondary"])},n(t.is_active?"Active":"Inactive"),3)]),s("td",null,[s("small",bs,n(t.last_login?a.formatDate(t.last_login):"Never"),1)]),s("td",null,[s("div",hs,[s("button",{class:"btn btn-outline-primary",onClick:m=>a.editUser(t),title:"Edit User"},e[43]||(e[43]=[s("i",{class:"bi bi-pencil"},null,-1)]),8,vs),s("button",{class:"btn btn-outline-success",onClick:m=>a.viewUserDetails(t),title:"View Details"},e[44]||(e[44]=[s("i",{class:"bi bi-eye"},null,-1)]),8,_s),s("button",{class:"btn btn-outline-info",onClick:m=>a.viewPermissions(t),title:"View Permissions"},e[45]||(e[45]=[s("i",{class:"bi bi-key"},null,-1)]),8,fs),s("button",{class:"btn btn-outline-danger",onClick:m=>a.deleteUser(t),disabled:t.role==="admin"&&r.statistics.admin_users<=1,title:"Delete User"},e[46]||(e[46]=[s("i",{class:"bi bi-trash"},null,-1)]),8,ys)])])]))),128))])])]))])]),r.showCreateModal||r.showEditModal?(i(),o("div",ws,[s("div",Us,[s("div",ks,[s("div",Ps,[s("h5",xs,n(r.editingUser?"Edit User":"Create New User"),1),s("button",{type:"button",class:"btn-close",onClick:e[3]||(e[3]=(...t)=>a.closeModal&&a.closeModal(...t))})]),s("div",Is,[s("form",{onSubmit:e[14]||(e[14]=U((...t)=>a.saveUser&&a.saveUser(...t),["prevent"]))},[s("div",As,[e[48]||(e[48]=s("label",{class:"form-label"},"Username *",-1)),v(s("input",{type:"text",class:"form-control","onUpdate:modelValue":e[4]||(e[4]=t=>r.userForm.username=t),disabled:r.editingUser,required:""},null,8,Gs),[[f,r.userForm.username]])]),s("div",Fs,[e[49]||(e[49]=s("label",{class:"form-label"},"Full Name",-1)),v(s("input",{type:"text",class:"form-control","onUpdate:modelValue":e[5]||(e[5]=t=>r.userForm.full_name=t)},null,512),[[f,r.userForm.full_name]])]),s("div",Cs,[e[50]||(e[50]=s("label",{class:"form-label"},"Email",-1)),v(s("input",{type:"email",class:"form-control","onUpdate:modelValue":e[6]||(e[6]=t=>r.userForm.email=t)},null,512),[[f,r.userForm.email]])]),s("div",Ss,[e[54]||(e[54]=s("label",{class:"form-label"},"Groups",-1)),v(s("select",{class:"form-select","onUpdate:modelValue":e[7]||(e[7]=t=>r.userForm.selectedGroupId=t),onChange:e[8]||(e[8]=(...t)=>a.handleGroupSelection&&a.handleGroupSelection(...t))},[e[51]||(e[51]=s("option",{value:""},"Choose a group...",-1)),(i(!0),o(p,null,g(r.availableGroups,t=>(i(),o("option",{key:t.id,value:t.id,disabled:a.isUserInGroup(t.id)},n(t.name)+" "+n(a.isUserInGroup(t.id)?"(Already assigned)":""),9,Ms))),128))],544),[[I,r.userForm.selectedGroupId]]),r.userForm.user_groups&&r.userForm.user_groups.length>0?(i(),o("div",Ns,[e[52]||(e[52]=s("small",{class:"text-muted"},"Current groups:",-1)),s("div",Vs,[(i(!0),o(p,null,g(r.userForm.user_groups,t=>(i(),o("span",{key:t.group_id,class:"badge",style:y(`background-color: ${t.group_color||"#6c757d"}; color: white;`)},[u(n(t.group_name)+" ",1),s("i",{class:"bi bi-x-circle ms-1",onClick:m=>a.removeUserFromGroup(t.group_id),style:{cursor:"pointer"}},null,8,Es)],4))),128))])])):(i(),o("div",Ds,e[53]||(e[53]=[s("i",{class:"bi bi-exclamation-circle"},null,-1),u(" No Groups Assigned ")])))]),s("div",Ls,[e[61]||(e[61]=s("label",{class:"form-label"},"VPN IP Address (Optional)",-1)),s("div",Ts,[v(s("input",{type:"text",class:"form-control","onUpdate:modelValue":e[9]||(e[9]=t=>r.userForm.manual_ip=t),placeholder:"Leave empty for auto-generation",pattern:"^(?:[0-9]{1,3}\\.){3}[0-9]{1,3}$",title:"Enter a valid IP address (e.g., 10.110.56.5)"},null,512),[[f,r.userForm.manual_ip]]),s("button",{class:"btn btn-outline-secondary",type:"button",onClick:e[10]||(e[10]=(...t)=>a.generateSuggestedIp&&a.generateSuggestedIp(...t)),title:"Generate suggested IP based on WireGuard subnet"},e[55]||(e[55]=[s("i",{class:"bi bi-lightning"},null,-1),u(" Suggest ")])),s("div",js,[s("button",{class:"btn btn-outline-info dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",disabled:!r.availableIps||Object.keys(r.availableIps).length===0,title:"Pick from available IP addresses"},e[56]||(e[56]=[s("i",{class:"bi bi-filter-circle me-1"},null,-1),u("Pick IP ")]),8,Rs),s("ul",Bs,[r.availableIps&&Object.keys(r.availableIps).length>0?(i(),o("li",Os,[s("div",Qs,[e[57]||(e[57]=s("label",{class:"text-muted"},[s("i",{class:"bi bi-search"})],-1)),v(s("input",{class:"form-control form-control-sm","onUpdate:modelValue":e[11]||(e[11]=t=>r.ipSearchString=t),placeholder:"Search IP..."},null,512),[[f,r.ipSearchString]])]),e[59]||(e[59]=s("hr",{class:"my-2"},null,-1)),s("div",zs,[e[58]||(e[58]=s("small",{class:"text-muted"},"Subnet",-1)),(i(!0),o(p,null,g(Object.keys(r.availableIps),t=>(i(),o("button",{key:t,onClick:m=>r.selectedSubnet=t,class:c([{"bg-primary-subtle":r.selectedSubnet===t},"btn btn-sm text-primary-emphasis rounded-3"])},n(t),11,Ks))),128))]),e[60]||(e[60]=s("hr",{class:"mt-2 mb-0"},null,-1))])):_("",!0),s("li",null,[s("div",qs,[(i(!0),o(p,null,g(a.filteredAvailableIps,t=>(i(),o("div",{key:t},[s("a",{class:"dropdown-item",onClick:m=>a.selectAvailableIp(t)},[s("small",null,n(t),1)],8,Ws)]))),128)),a.filteredAvailableIps.length===0?(i(),o("div",Hs,[s("small",Ys,n(r.ipSearchString?`No IP containing "${r.ipSearchString}"`:"No available IPs"),1)])):_("",!0)])])])])]),e[62]||(e[62]=s("small",{class:"form-text text-muted"},[s("i",{class:"bi bi-info-circle me-1"}),u(" Leave empty to auto-generate, specify manually, or pick from available IPs ")],-1))]),s("div",Js,[s("label",Xs,"Password "+n(r.editingUser?"(leave blank to keep current)":"*"),1),v(s("input",{type:"password",class:"form-control","onUpdate:modelValue":e[12]||(e[12]=t=>r.userForm.password=t),required:!r.editingUser},null,8,Zs),[[f,r.userForm.password]])]),r.editingUser?(i(),o("div",$s,[s("div",se,[v(s("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[13]||(e[13]=t=>r.userForm.is_active=t),id:"isActive"},null,512),[[A,r.userForm.is_active]]),e[63]||(e[63]=s("label",{class:"form-check-label",for:"isActive"}," Active ",-1))])])):_("",!0)],32)]),s("div",ee,[s("button",{type:"button",class:"btn btn-secondary",onClick:e[15]||(e[15]=(...t)=>a.closeModal&&a.closeModal(...t))},"Cancel"),s("button",{type:"button",class:"btn btn-primary",onClick:e[16]||(e[16]=(...t)=>a.saveUser&&a.saveUser(...t)),disabled:r.saving},[r.saving?(i(),o("span",le)):_("",!0),u(" "+n(r.editingUser?"Update":"Create"),1)],8,te)])])])])):_("",!0),r.showPermissionsModal?(i(),o("div",re,[s("div",oe,[s("div",ie,[s("div",ne,[s("h5",ae,"User Permissions - "+n(r.selectedUser?.username),1),s("button",{type:"button",class:"btn-close",onClick:e[17]||(e[17]=t=>r.showPermissionsModal=!1)})]),s("div",de,[r.loadingPermissions?(i(),o("div",ue,e[64]||(e[64]=[s("div",{class:"spinner-border",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1)]))):(i(),o("div",ce,[s("div",me,[s("div",pe,[e[66]||(e[66]=s("h6",null,"Available Permissions",-1)),s("div",ge,[(i(!0),o(p,null,g(r.availablePermissions,t=>(i(),o("button",{key:t,class:"list-group-item list-group-item-action d-flex justify-content-between align-items-center",onClick:m=>a.grantPermission(t)},[u(n(a.formatPermission(t))+" ",1),e[65]||(e[65]=s("i",{class:"bi bi-plus-circle text-success"},null,-1))],8,be))),128))])]),s("div",he,[e[68]||(e[68]=s("h6",null,"Granted Permissions",-1)),s("div",ve,[(i(!0),o(p,null,g(r.userPermissions,t=>(i(),o("div",{key:t,class:"list-group-item d-flex justify-content-between align-items-center"},[u(n(a.formatPermission(t))+" ",1),s("button",{class:"btn btn-sm btn-outline-danger",onClick:m=>a.revokePermission(t)},e[67]||(e[67]=[s("i",{class:"bi bi-x-circle"},null,-1)]),8,_e)]))),128))])])])]))]),s("div",fe,[s("button",{type:"button",class:"btn btn-secondary",onClick:e[18]||(e[18]=t=>r.showPermissionsModal=!1)},"Close")])])])])):_("",!0),r.showUserDetailsModal?(i(),o("div",ye,[s("div",we,[s("div",Ue,[s("div",ke,[s("h5",Pe,"User Details - "+n(r.selectedUser?.username),1),s("button",{type:"button",class:"btn-close",onClick:e[19]||(e[19]=t=>r.showUserDetailsModal=!1)})]),s("div",xe,[s("ul",Ie,[s("li",Ae,[s("a",{class:c(["nav-link",{active:r.activeTab==="userInfo"}]),href:"#userInfo",onClick:e[20]||(e[20]=U(t=>r.activeTab="userInfo",["prevent"]))},"User Info",2)]),s("li",Ge,[s("a",{class:c(["nav-link",{active:r.activeTab==="userGroups"}]),href:"#userGroups",onClick:e[21]||(e[21]=U(t=>r.activeTab="userGroups",["prevent"]))},"Groups",2)]),s("li",Fe,[s("a",{class:c(["nav-link",{active:r.activeTab==="vpnPeers"}]),href:"#vpnPeers",onClick:e[22]||(e[22]=U(t=>r.activeTab="vpnPeers",["prevent"]))},"VPN Peers",2)])]),s("div",Ce,[s("div",{class:c(["tab-pane fade",{"show active":r.activeTab==="userInfo"}]),id:"userInfo"},[s("div",Se,[s("div",Me,[e[75]||(e[75]=s("h6",null,"Basic Information",-1)),s("table",Ne,[s("tr",null,[e[69]||(e[69]=s("td",null,[s("strong",null,"Username:")],-1)),s("td",null,n(r.selectedUser?.username),1)]),s("tr",null,[e[70]||(e[70]=s("td",null,[s("strong",null,"Full Name:")],-1)),s("td",null,n(r.selectedUser?.full_name||"Not set"),1)]),s("tr",null,[e[71]||(e[71]=s("td",null,[s("strong",null,"Email:")],-1)),s("td",null,n(r.selectedUser?.email||"Not set"),1)]),s("tr",null,[e[73]||(e[73]=s("td",null,[s("strong",null,"Groups:")],-1)),s("td",null,[r.selectedUser?.user_groups&&r.selectedUser.user_groups.length>0?(i(),o("div",Ve,[(i(!0),o(p,null,g(r.selectedUser.user_groups,t=>(i(),o("span",{key:t.group_id,class:"badge me-1 mb-1",style:y(`background-color: ${t.group_color||"#6c757d"}; color: white;`)},n(t.group_name),5))),128))])):(i(),o("span",Ee,e[72]||(e[72]=[s("i",{class:"bi bi-exclamation-circle"},null,-1),u(" No Groups Assigned ")])))])]),s("tr",null,[e[74]||(e[74]=s("td",null,[s("strong",null,"Status:")],-1)),s("td",null,[s("span",{class:c(["badge",r.selectedUser?.is_active?"bg-success":"bg-danger"])},n(r.selectedUser?.is_active?"Active":"Inactive"),3)])])])]),s("div",De,[e[80]||(e[80]=s("h6",null,"Account Information",-1)),s("table",Le,[s("tr",null,[e[76]||(e[76]=s("td",null,[s("strong",null,"Created:")],-1)),s("td",null,n(a.formatDate(r.selectedUser?.created_at)),1)]),s("tr",null,[e[77]||(e[77]=s("td",null,[s("strong",null,"Last Updated:")],-1)),s("td",null,n(a.formatDate(r.selectedUser?.updated_at)),1)]),s("tr",null,[e[78]||(e[78]=s("td",null,[s("strong",null,"Last Login:")],-1)),s("td",null,n(r.selectedUser?.last_login?a.formatDate(r.selectedUser.last_login):"Never"),1)]),s("tr",null,[e[79]||(e[79]=s("td",null,[s("strong",null,"MFA Enabled:")],-1)),s("td",null,[s("i",{class:c(["bi",r.selectedUser?.mfa_enabled?"bi-shield-check text-success":"bi-shield-x text-danger"])},null,2),u(" "+n(r.selectedUser?.mfa_enabled?"Enabled":"Disabled"),1)])])])])])],2),s("div",{class:c(["tab-pane fade",{"show active":r.activeTab==="userGroups"}]),id:"userGroups"},[s("div",Te,[s("div",je,[e[84]||(e[84]=s("h6",null,"Group Memberships",-1)),r.loadingUserGroups?(i(),o("div",Re,e[81]||(e[81]=[s("div",{class:"spinner-border",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1)]))):r.userGroups.length===0?(i(),o("div",Be,e[82]||(e[82]=[s("i",{class:"bi bi-people",style:{"font-size":"2rem"}},null,-1),s("p",{class:"mt-2 mb-0"},"User is not assigned to any groups",-1)]))):(i(),o("div",Oe,[(i(!0),o(p,null,g(r.userGroups,t=>(i(),o("div",{key:t.id,class:"card mb-2"},[s("div",Qe,[s("div",ze,[s("div",null,[s("div",Ke,[s("div",{class:"me-2",style:y(`width: 12px; height: 12px; background-color: ${t.color}; border-radius: 50%;`)},null,4),s("strong",null,n(t.group_name),1)]),s("small",qe,n(t.description),1)]),s("div",We,[s("span",{class:c(["badge",a.getGroupStatusBadge(t)])},n(t.vpn_peer_generated?"VPN Active":"No VPN"),3),e[83]||(e[83]=s("br",null,null,-1)),s("small",He,n(t.vpn_server_name),1)])])])]))),128))]))]),s("div",Ye,[e[87]||(e[87]=s("h6",null,"Quick Actions",-1)),s("div",Je,[s("button",{class:"btn btn-primary btn-sm",onClick:e[23]||(e[23]=(...t)=>a.assignUserToGroup&&a.assignUserToGroup(...t))},e[85]||(e[85]=[s("i",{class:"bi bi-plus-circle me-1"},null,-1),u(" Assign to Group ")])),s("button",{class:"btn btn-outline-secondary btn-sm",onClick:e[24]||(e[24]=(...t)=>a.loadUserGroups&&a.loadUserGroups(...t))},e[86]||(e[86]=[s("i",{class:"bi bi-arrow-clockwise me-1"},null,-1),u(" Refresh Groups ")]))])])])],2),s("div",{class:c(["tab-pane fade",{"show active":r.activeTab==="vpnPeers"}]),id:"vpnPeers"},[s("div",Xe,[s("div",Ze,[e[92]||(e[92]=s("h6",null,"VPN Peer Status",-1)),r.loadingVpnPeers?(i(),o("div",$e,e[88]||(e[88]=[s("div",{class:"spinner-border",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1)]))):r.vpnPeers.length===0?(i(),o("div",st,e[89]||(e[89]=[s("i",{class:"bi bi-shield-lock",style:{"font-size":"2rem"}},null,-1),s("p",{class:"mt-2 mb-0"},"No VPN peers generated",-1)]))):(i(),o("div",et,[(i(!0),o(p,null,g(r.vpnPeers,t=>(i(),o("div",{key:t.id,class:"card mb-2"},[s("div",tt,[s("div",lt,[s("div",null,[s("div",rt,[s("div",{class:"me-2",style:y(`width: 12px; height: 12px; background-color: ${t.group_color}; border-radius: 50%;`)},null,4),s("strong",null,n(t.group_name),1)]),s("small",ot,n(t.vpn_server_name)+" • "+n(t.peer_ip),1)]),s("div",it,[s("span",{class:c(["badge",t.config_generated?"bg-success":"bg-warning"])},n(t.config_generated?"Generated":"Pending"),3),e[91]||(e[91]=s("br",null,null,-1)),s("button",{class:"btn btn-sm btn-outline-primary mt-1",onClick:m=>a.downloadVpnConfig(t)},e[90]||(e[90]=[s("i",{class:"bi bi-download me-1"},null,-1),u(" Download Config ")]),8,nt)])])])]))),128))]))]),s("div",at,[e[96]||(e[96]=s("h6",null,"VPN Summary",-1)),s("div",dt,[s("div",ut,[s("div",ct,[s("div",mt,[s("h4",pt,n(r.vpnPeers.length),1),e[93]||(e[93]=s("small",null,"Total Peers",-1))]),s("div",gt,[s("h4",bt,n(r.vpnPeers.filter(t=>t.config_generated).length),1),e[94]||(e[94]=s("small",null,"Generated",-1))]),s("div",ht,[s("h4",vt,n(r.vpnPeers.filter(t=>!t.config_generated).length),1),e[95]||(e[95]=s("small",null,"Pending",-1))])])])])])])],2)])]),s("div",_t,[s("button",{type:"button",class:"btn btn-secondary",onClick:e[25]||(e[25]=t=>r.showUserDetailsModal=!1)},"Close")])])])])):_("",!0),r.alert.show?(i(),o("div",{key:3,class:c(["alert alert-dismissible",r.alert.type]),role:"alert"},[u(n(r.alert.message)+" ",1),s("button",{type:"button",class:"btn-close",onClick:e[26]||(e[26]=t=>r.alert.show=!1)})],2)):_("",!0)])}const wt=P(G,[["render",ft],["__scopeId","data-v-687d2c90"]]);export{wt as default};
//# sourceMappingURL=userManagement-2lyjCcPx.js.map
